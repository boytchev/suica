function perspective(t,i,e){Suica.lastContext&&Suica.lastContext.perspective(t,i,e)}function orthographic(t,i){Suica.lastContext&&Suica.lastContext.orthographic(t,i)}function lookAt(t,i,e){Suica.lastContext&&Suica.lastContext.lookAt(t,i,e)}function background(t){Suica.lastContext&&Suica.lastContext.background(t)}function oxyz(t){Suica.lastContext&&Suica.lastContext.oxyz(t)}function demo(t,i,e,r){Suica.lastContext&&Suica.lastContext.demo(t,i,e,r)}function mainAnimationLoop(){var t=new Date;t=(t.getTime()-Suica.startTime)/1e3,Suica.dTime=t-Suica.time,Suica.time=t;for(var i=0;i<Suica.contextList.length;i++)Suica.contextList[i].redrawFrame(t);for(var i=0;i<Suica.contextList.length;i++){var e=Suica.contextList[i];e.renderMode=Suica.NONPOINT,e.hasPoints=!1;for(var r=0;r<e.objectList.length;r++)e.objectList[r].drawObject();if(e.hasPoints){e.useShader(e.shaderProgramPoints),e.renderMode=Suica.POINT;for(var r=0;r<e.objectList.length;r++)e.objectList[r].drawObject();e.useShader(e.shaderProgram)}e.renderMode=Suica.ALL}requestAnimationFrame(mainAnimationLoop)}function square(t,i){return new Suica.Square(t,i)}function rectangle(t,i){return new Suica.Rectangle(t,i)}function point(t){return new Suica.Point(t)}function cube(t,i){return new Suica.Cube(t,i)}function cuboid(t,i){return new Suica.Cuboid(t,i)}function polygon(t,i,e){return new Suica.Polygon(t,i,e)}function circle(t,i){return new Suica.Circle(t,i)}function ellipse(t,i){return new Suica.Ellipse(t,i)}function pyramid(t,i,e,r){return new Suica.Pyramid(t,i,e,r)}function cone(t,i,e){return new Suica.Cone(t,i,e)}function conoid(t,i,e){return new Suica.Conoid(t,i,e)}function prism(t,i,e,r){return new Suica.Prism(t,i,e,r)}function cylinder(t,i,e){return new Suica.Cylinder(t,i,e)}function cylindroid(t,i,e){return new Suica.Cylindroid(t,i,e)}function segment(t,i){return new Suica.Segment(t,i)}function line(t,i){return new Suica.Line(t,i)}function ray(t,i){return new Suica.Ray(t,i)}function segment(t,i){return new Suica.Segment(t,i)}function sphere(t,i){return new Suica.Sphere(t,i)}function spheroid(t,i){return new Suica.Spheroid(t,i)}function group(t){return new Suica.Group(t)}var vsSource="	uniform mat4 uProjectionMatrix;		uniform mat4 uViewMatrix;			uniform mat4 uModelMatrix;			uniform mat3 uNormalMatrix;			uniform bool uUseNormal;			uniform bool uLight;				uniform   vec2 uTexScale;			uniform   vec2 uTexOffset;			uniform float uPointSize;			attribute vec3 aXYZ;				varying   vec4 vXYZT;				attribute vec3 aNormal;				varying   vec4 vNormal;				attribute vec3 aColor;				varying   vec3 vColor;				attribute vec2 aTexCoord;			varying   vec2 vTexCoord;			void main ()						{										if (uLight) 						{										if (uUseNormal)							vNormal = normalize(vec4(uNormalMatrix*aNormal,0)); 				else									vNormal = normalize(uViewMatrix * uModelMatrix * vec4(aNormal,0)); 			}									vColor = aColor;					vTexCoord = aTexCoord*uTexScale-uTexOffset;			vXYZT =  vec4(aXYZ,1);			gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aXYZ,1);			gl_PointSize = uPointSize;		}								",fsSource="		uniform sampler2D uSampler; 			precision mediump float;				uniform bool uLight;					uniform bool uTexture;					uniform int uClipPlanes;				uniform vec4 uClipPlane[3];				varying vec4 vXYZT;						varying vec4 vNormal;					varying vec3 vColor;					varying vec2 vTexCoord;					void main( )							{											if (uClipPlanes>0)						{											if (dot(vXYZT,uClipPlane[0])<0.0) discard;				if (uClipPlanes>1)						{											if (dot(vXYZT,uClipPlane[1])<0.0) discard;					if (uClipPlanes>2)						{											if (dot(vXYZT,uClipPlane[2])<0.0) discard;					}									}									}										vec4 color;																	if (uTexture)																	color = texture2D(uSampler,vTexCoord);									else																			color = vec4(vColor,1.0);												float diffLight = uLight?abs(vNormal.z):1.0;								gl_FragColor = vec4((diffLight*0.8+0.2)*color.rgb,color.a);				}																	",fsSourcePoints="		uniform sampler2D uSampler; 			precision mediump float;				uniform bool uLight;					uniform bool uTexture;					uniform int uClipPlanes;				uniform vec4 uClipPlane[3];				uniform highp float uPointSize;				varying vec4 vXYZT;						varying vec4 vNormal;					varying vec3 vColor;					varying vec2 vTexCoord;					void main( )							{											if (uClipPlanes>0)						{											if (dot(vXYZT,uClipPlane[0])<0.0) discard;				if (uClipPlanes>1)						{											if (dot(vXYZT,uClipPlane[1])<0.0) discard;					if (uClipPlanes>2)						{											if (dot(vXYZT,uClipPlane[2])<0.0) discard;					}									}									}										float dist = distance( gl_PointCoord, vec2(0.5) );							if (uPointSize>3.5)													{	if (dist > 0.5) discard;													}			vec4 color;																	if (uTexture)																	color = texture2D(uSampler,vTexCoord);									else																			color = vec4(vColor,1.0);												float diffLight = uLight?abs(vNormal.z):1.0;								gl_FragColor = vec4((diffLight*0.8+0.2)*color.rgb,color.a);				}																	",vsSourceSelect="	uniform mat4 uProjectionMatrix;		uniform mat4 uViewMatrix;			uniform mat4 uModelMatrix;			uniform float uPointSize;			attribute vec3 aXYZ;				varying   vec4 vXYZT;				attribute vec3 aColor;				varying   vec3 vColor;				void main ()						{										vColor = aColor;					vXYZT =  vec4(aXYZ,1);			gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aXYZ,1);			gl_PointSize = uPointSize;		}								",fsSourceSelect="	precision mediump float;		uniform int uClipPlanes;		uniform vec4 uClipPlane[3];		varying vec3 vColor;			varying vec4 vXYZT;				void main( )					{									if (uClipPlanes>0)				{									if (dot(vXYZT,uClipPlane[0])<0.0) discard;			if (uClipPlanes>1)				{									if (dot(vXYZT,uClipPlane[1])<0.0) discard;				if (uClipPlanes>2)				{									if (dot(vXYZT,uClipPlane[2])<0.0) discard;				}							}							}								gl_FragColor = vec4(vColor,1.0);	}							",Suica=function(t){if(!t){var i,e=document.getElementsByTagName("canvas");e.length?i=e[0]:(i=document.createElement("canvas"),document.body.appendChild(i)),i.id||(i.id="suica_canvas"),t=i.id}this.gl=Suica.getContext(t,{antialias:!0,alpha:!0}),this.shaderProgram=Suica.getProgram(this.gl,vsSource,fsSource),this.shaderProgramPoints=Suica.getProgram(this.gl,vsSource,fsSourcePoints),this.shaderProgramSelect=Suica.getProgram(this.gl,vsSourceSelect,fsSourceSelect),this.viewMatrix=this.identityMatrix(),this.modelMatrix=this.identityMatrix(),this.projectionMatrix=this.identityMatrix(),this.useShader(this.shaderProgram),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enableVertexAttribArray(this.aXYZ),this.gl.disable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.newModelMatrix=!0,this.modelMatrixStack=[],this.normalMatrix=new Float32Array(9),this.perspective(30,1,4e4),this.lookAt([100*Math.cos(Math.PI/6),100*Math.sin(Math.PI/6),30],[0,0,0],[0,0,1]),this.demoViewPoint=null,this.backgroundColor=[1,1,1],this.nextFrame=null,Suica.contextList.push(this),Suica.lastContext=this,this.renderMode=Suica.ALL,this.hasPoints=!1,this.objectList=[]};Suica.prototype.useShader=function(t){return t==this.shaderProgram?(this.uProjectionMatrix=this.gl.getUniformLocation(this.shaderProgram,"uProjectionMatrix"),this.uViewMatrix=this.gl.getUniformLocation(this.shaderProgram,"uViewMatrix"),this.uModelMatrix=this.gl.getUniformLocation(this.shaderProgram,"uModelMatrix"),this.uNormalMatrix=this.gl.getUniformLocation(this.shaderProgram,"uNormalMatrix"),this.uUseNormal=this.gl.getUniformLocation(this.shaderProgram,"uUseNormal"),this.uLight=this.gl.getUniformLocation(this.shaderProgram,"uLight"),this.uPointSize=this.gl.getUniformLocation(this.shaderProgram,"uPointSize"),this.uTexture=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.uSampler=this.gl.getUniformLocation(this.shaderProgram,"uSampler"),this.uTexScale=this.gl.getUniformLocation(this.shaderProgram,"uTexScale"),this.uTexOffset=this.gl.getUniformLocation(this.shaderProgram,"uTexOffset"),this.uClipPlanes=this.gl.getUniformLocation(this.shaderProgram,"uClipPlanes"),this.uClipPlane=this.gl.getUniformLocation(this.shaderProgram,"uClipPlane"),this.aXYZ=this.gl.getAttribLocation(this.shaderProgram,"aXYZ"),this.aNormal=this.gl.getAttribLocation(this.shaderProgram,"aNormal"),this.aColor=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.aTexCoord=this.gl.getAttribLocation(this.shaderProgram,"aTexCoord"),this.gl.useProgram(t),this.gl.uniform1i(this.uUseNormal,!1),this.gl.uniformMatrix4fv(this.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.uViewMatrix,!1,this.viewMatrix),this.gl.uniformMatrix4fv(this.uModelMatrix,!1,this.modelMatrix),void(Suica.normalRender=!0)):t==this.shaderProgramPoints?(this.uProjectionMatrix=this.gl.getUniformLocation(this.shaderProgramPoints,"uProjectionMatrix"),this.uViewMatrix=this.gl.getUniformLocation(this.shaderProgramPoints,"uViewMatrix"),this.uModelMatrix=this.gl.getUniformLocation(this.shaderProgramPoints,"uModelMatrix"),this.uNormalMatrix=this.gl.getUniformLocation(this.shaderProgramPoints,"uNormalMatrix"),this.uUseNormal=this.gl.getUniformLocation(this.shaderProgramPoints,"uUseNormal"),this.uLight=this.gl.getUniformLocation(this.shaderProgramPoints,"uLight"),this.uPointSize=this.gl.getUniformLocation(this.shaderProgramPoints,"uPointSize"),this.uTexture=this.gl.getUniformLocation(this.shaderProgramPoints,"uTexture"),this.uSampler=this.gl.getUniformLocation(this.shaderProgramPoints,"uSampler"),this.uTexScale=this.gl.getUniformLocation(this.shaderProgramPoints,"uTexScale"),this.uTexOffset=this.gl.getUniformLocation(this.shaderProgramPoints,"uTexOffset"),this.uClipPlanes=this.gl.getUniformLocation(this.shaderProgramPoints,"uClipPlanes"),this.uClipPlane=this.gl.getUniformLocation(this.shaderProgramPoints,"uClipPlane"),this.aXYZ=this.gl.getAttribLocation(this.shaderProgramPoints,"aXYZ"),this.aNormal=this.gl.getAttribLocation(this.shaderProgramPoints,"aNormal"),this.aColor=this.gl.getAttribLocation(this.shaderProgramPoints,"aColor"),this.aTexCoord=this.gl.getAttribLocation(this.shaderProgramPoints,"aTexCoord"),this.gl.useProgram(t),this.gl.uniform1i(this.uUseNormal,!1),this.gl.uniformMatrix4fv(this.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.uViewMatrix,!1,this.viewMatrix),this.gl.uniformMatrix4fv(this.uModelMatrix,!1,this.modelMatrix),void(Suica.normalRender=!0)):t==this.shaderProgramSelect?(this.gl.disableVertexAttribArray(this.aTexCoord),this.gl.disableVertexAttribArray(this.aNormal),this.uProjectionMatrix=this.gl.getUniformLocation(this.shaderProgramSelect,"uProjectionMatrix"),this.uViewMatrix=this.gl.getUniformLocation(this.shaderProgramSelect,"uViewMatrix"),this.uModelMatrix=this.gl.getUniformLocation(this.shaderProgramSelect,"uModelMatrix"),this.uPointSize=this.gl.getUniformLocation(this.shaderProgramSelect,"uPointSize"),this.uClipPlanes=this.gl.getUniformLocation(this.shaderProgramSelect,"uClipPlanes"),this.uClipPlane=this.gl.getUniformLocation(this.shaderProgramSelect,"uClipPlane"),this.aXYZ=this.gl.getAttribLocation(this.shaderProgramSelect,"aXYZ"),this.aColor=this.gl.getAttribLocation(this.shaderProgramSelect,"aColor"),this.gl.useProgram(this.shaderProgramSelect),this.gl.uniformMatrix4fv(this.uProjectionMatrix,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.uViewMatrix,!1,this.viewMatrix),this.gl.uniformMatrix4fv(this.uModelMatrix,!1,this.modelMatrix),void(Suica.normalRender=!1)):void console.log("suica.js: useShader(): invalid shader")},Suica.contextList=[],Suica.lastContext=null,Suica.startTime=(new Date).getTime(),Suica.time=0,Suica.dTime=0,Suica.FLOATS=Float32Array.BYTES_PER_ELEMENT,Suica.normalRender=!0,Suica.POINT=1,Suica.LINE=2,Suica.SOLID=3,Suica.ALL=4,Suica.NONPOINT=5,Suica.PRECISION=48,Suica.id=0,Suica.getContext=function(t){var i=document.getElementById(t);if(!i)return alert("Не е намерен елемент canvas с id="+t+" [getContext]"),null;i.addEventListener("webglcontextlost",function(t){t.preventDefault()},!1),i.addEventListener("webglcontextrestored",function(){console.log("Boo!")},!1);var e=i.getContext("webgl")||i.getContext("experimental-webgl");return e||alert("Не е създаден графичен контекст [getContext]"),e},Suica.getShader=function(t,i,e){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(alert(t.getShaderInfoLog(r)),null)},Suica.getProgram=function(t,i,e){var r=Suica.getShader(t,i,t.VERTEX_SHADER),a=Suica.getShader(t,e,t.FRAGMENT_SHADER);if(!r||!a)return null;var o=t.createProgram();return t.bindAttribLocation(o,0,"aXYZ"),t.attachShader(o,r),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert(t.getProgramInfoLog(o)),null)},Suica.prototype.perspective=function(t,i,e){var r=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,a=1/Math.tan(radians(t)/2);this.projectionMatrix=new Float32Array([a/r,0,0,0,0,a,0,0,0,0,(e+i)/(i-e),-1,0,0,2*i*e/(i-e),0]),this.gl.uniformMatrix4fv(this.uProjectionMatrix,!1,this.projectionMatrix)},Suica.prototype.orthographic=function(t,i){var e=this.gl.canvas.clientWidth,r=this.gl.canvas.clientHeight,a=new Float32Array([2/e,0,0,0,0,2/r,0,0,0,0,2/(t-i),0,0,0,(i+t)/(t-i),1]);this.gl.uniformMatrix4fv(this.uProjectionMatrix,!1,a)},Suica.prototype.lookAt=function(t,i,e){var r=Suica.unitVector(Suica.vectorPoints(t,i)),a=Suica.unitVector(Suica.vectorProduct(e,r)),o=Suica.unitVector(Suica.vectorProduct(r,a));this.viewMatrix=new Float32Array([a[0],o[0],r[0],0,a[1],o[1],r[1],0,a[2],o[2],r[2],0,-Suica.scalarProduct(a,t),-Suica.scalarProduct(o,t),-Suica.scalarProduct(r,t),1]),this.gl.uniformMatrix4fv(this.uViewMatrix,!1,this.viewMatrix)},Suica.prototype.background=function(t){this.backgroundColor=t},Suica.prototype.oxyz=function(t){t||(t=30),point([0,0,0]).custom({pointSize:6,color:[0,0,0]}),segment([0,0,0],[t,0,0]).custom({color:[0,0,0]}),segment([0,0,0],[0,t,0]).custom({color:[0,0,0]}),segment([0,0,0],[0,0,t]).custom({color:[0,0,0]})},Suica.prototype.demo=function(t,i,e,r){t=t||100,i=i||1,void 0===e&&(e=.3),void 0===r&&(r=0),i=i*Math.PI/10,this.demoViewPoint={distance:t,speed:i,height:e,target:r}},Suica.prototype.identityMatrix=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},Suica.prototype.identity=function(){this.newModelMatrix=!0,this.modelMatrix=this.identityMatrix()},Suica.prototype.scale=function(t){this.newModelMatrix=!0;var i=this.modelMatrix;i[0]*=t[0],i[1]*=t[0],i[2]*=t[0],i[4]*=t[1],i[5]*=t[1],i[6]*=t[1],i[8]*=t[2],i[9]*=t[2],i[10]*=t[2]},Suica.prototype.translate=function(t){this.newModelMatrix=!0;var i=this.modelMatrix;i[12]+=i[0]*t[0]+i[4]*t[1]+i[8]*t[2],i[13]+=i[1]*t[0]+i[5]*t[1]+i[9]*t[2],i[14]+=i[2]*t[0]+i[6]*t[1]+i[10]*t[2]},Suica.prototype.yRotate=function(t){this.newModelMatrix=!0;var i=this.modelMatrix,e=Math.sin(t),r=Math.cos(t);t=i[0]*e+i[8]*r,i[0]=i[0]*r-i[8]*e,i[8]=t,t=i[1]*e+i[9]*r,i[1]=i[1]*r-i[9]*e,i[9]=t,t=i[2]*e+i[10]*r,i[2]=i[2]*r-i[10]*e,i[10]=t},Suica.prototype.zRotate=function(t){this.newModelMatrix=!0;var i=this.modelMatrix,e=Math.sin(t),r=Math.cos(t);t=i[0]*e+i[4]*r,i[0]=i[0]*r-i[4]*e,i[4]=t,t=i[1]*e+i[5]*r,i[1]=i[1]*r-i[5]*e,i[5]=t,t=i[2]*e+i[6]*r,i[2]=i[2]*r-i[6]*e,i[6]=t},Suica.prototype.matrixMultiply=function(t,i){var e=[],r=i[0],a=i[1],o=i[2],s=i[3];return e[0]=r*t[0]+a*t[4]+o*t[8]+s*t[12],e[1]=r*t[1]+a*t[5]+o*t[9]+s*t[13],e[2]=r*t[2]+a*t[6]+o*t[10]+s*t[14],e[3]=r*t[3]+a*t[7]+o*t[11]+s*t[15],r=i[4],a=i[5],o=i[6],s=i[7],e[4]=r*t[0]+a*t[4]+o*t[8]+s*t[12],e[5]=r*t[1]+a*t[5]+o*t[9]+s*t[13],e[6]=r*t[2]+a*t[6]+o*t[10]+s*t[14],e[7]=r*t[3]+a*t[7]+o*t[11]+s*t[15],r=i[8],a=i[9],o=i[10],s=i[11],e[8]=r*t[0]+a*t[4]+o*t[8]+s*t[12],e[9]=r*t[1]+a*t[5]+o*t[9]+s*t[13],e[10]=r*t[2]+a*t[6]+o*t[10]+s*t[14],e[11]=r*t[3]+a*t[7]+o*t[11]+s*t[15],r=i[12],a=i[13],o=i[14],s=i[15],e[12]=r*t[0]+a*t[4]+o*t[8]+s*t[12],e[13]=r*t[1]+a*t[5]+o*t[9]+s*t[13],e[14]=r*t[2]+a*t[6]+o*t[10]+s*t[14],e[15]=r*t[3]+a*t[7]+o*t[11]+s*t[15],e},Suica.prototype.transposeInverse=function(){var t=this.matrixMultiply(this.viewMatrix,this.modelMatrix),i=t[0]*t[5]-t[1]*t[4],e=t[0]*t[6]-t[2]*t[4],r=t[0]*t[7]-t[3]*t[4],a=t[1]*t[6]-t[2]*t[5],o=t[1]*t[7]-t[3]*t[5],s=t[2]*t[7]-t[3]*t[6],c=t[8]*t[13]-t[9]*t[12],h=t[8]*t[14]-t[10]*t[12],n=t[8]*t[15]-t[11]*t[12],u=t[9]*t[14]-t[10]*t[13],l=t[9]*t[15]-t[11]*t[13],S=t[10]*t[15]-t[11]*t[14],f=1/(i*S-e*l+r*u+a*n-o*h+s*c);this.normalMatrix[0]=(t[5]*S-t[6]*l+t[7]*u)*f,this.normalMatrix[1]=(t[6]*n-t[4]*S-t[7]*h)*f,this.normalMatrix[2]=(t[4]*l-t[5]*n+t[7]*c)*f,this.normalMatrix[3]=(t[2]*l-t[1]*S-t[3]*u)*f,this.normalMatrix[4]=(t[0]*S-t[2]*n+t[3]*h)*f,this.normalMatrix[5]=(t[1]*n-t[0]*l-t[3]*c)*f,this.normalMatrix[6]=(t[13]*s-t[14]*o+t[15]*a)*f,this.normalMatrix[7]=(t[14]*r-t[12]*s-t[15]*e)*f,this.normalMatrix[8]=(t[12]*o-t[13]*r+t[15]*i)*f},Suica.prototype.cloneMatrix=function(t){var i=new Float32Array(t.length);return i.set(t),i},Suica.prototype.pushMatrix=function(){this.modelMatrixStack.push(this.cloneMatrix(this.modelMatrix))},Suica.prototype.popMatrix=function(){this.newModelMatrix=!0,this.modelMatrix.length?this.modelMatrix=this.modelMatrixStack.pop():identity()},Suica.prototype.useModelMatrix=function(){this.newModelMatrix&&(this.newModelMatrix=!1,this.gl.uniformMatrix4fv(this.uModelMatrix,!1,this.modelMatrix))},Suica.prototype.redrawFrame=function(){this.gl.clearColor(this.backgroundColor[0],this.backgroundColor[1],this.backgroundColor[2],1),this.gl.clear(this.gl.COLOR_BUFFER_BIT+this.gl.DEPTH_BUFFER_BIT),null!=this.demoViewPoint&&this.lookAt([this.demoViewPoint.distance*Math.sin(this.demoViewPoint.speed*Suica.time),this.demoViewPoint.distance*Math.cos(this.demoViewPoint.speed*Suica.time),this.demoViewPoint.distance*this.demoViewPoint.height],[0,0,this.demoViewPoint.distance*this.demoViewPoint.target],[0,0,1]),this.nextFrame&&this.nextFrame()},Suica.prototype.objectAtPoint=function(t,i){var e=this.gl.canvas.getBoundingClientRect();this.useShader(this.shaderProgramSelect),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT+this.gl.DEPTH_BUFFER_BIT);for(var r=0;r<this.objectList.length;r++)this.objectList[r].drawObject();var a=new Uint8Array(4);this.gl.readPixels(t-e.left,e.bottom-i,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a);var o=a[0]+(a[1]<<8)+(a[2]<<16),s=null;if(o<=Suica.id)for(var r=0;r<this.objectList.length;r++)if(this.objectList[r].interactive&&this.objectList[r].id==o){this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT+this.gl.DEPTH_BUFFER_BIT),this.objectList[r].drawObject(),this.gl.readPixels(t-e.left,e.bottom-i,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a);var c=a[0]+(a[1]<<8)+(a[2]<<16);if(o==c){s=this.objectList[r];break}}return this.useShader(this.shaderProgram),s},Suica.random=function(t,i){return t+(i-t)*Math.random()},Suica.radians=function(t){return t*Math.PI/180},Suica.unitVector=function(t){var i=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[i*t[0],i*t[1],i*t[2]]},Suica.vectorProduct=function(t,i){return[t[1]*i[2]-t[2]*i[1],t[2]*i[0]-t[0]*i[2],t[0]*i[1]-t[1]*i[0]]},Suica.scalarProduct=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},Suica.vectorPoints=function(t,i){return[t[0]-i[0],t[1]-i[1],t[2]-i[2]]},Suica.sameAs=function(t){var i={};for(var e in t)i[e]=t[e];return t.ctx.objectList.push(i),i},Suica.scrollLeft=function(){return Math.max(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)},Suica.scrollTop=function(){return Math.max(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)};var random=Suica.random,radians=Suica.radians,unitVector=Suica.unitVector,vectorProduct=Suica.vectorProduct,scalarProduct=Suica.scalarProduct,vectorPoints=Suica.vectorPoints,sameAs=Suica.sameAs;mainAnimationLoop(),Suica.version="1.0.03 (150413)",Suica.Object=function(){Suica.id+=3,this.id=Suica.id,this.idColor=[(255&this.id)/255,(this.id>>8&255)/255,(this.id>>16&255)/255],this.ctx=Suica.lastContext,this.color=[0,0,0],this.origin=[0,0,0],this.light=!0,this.visible=!0,this.hollow=!1,this.interactive=!1,this.mode=Suica.SOLID,this.pointSize=3,this.focus=null,this.spin=null,this.image=null,Suica.lastContext.objectList.push(this)},Suica.Object.prototype.drawObject=function(){if(this.visible){if(this.mode==Suica.POINT&&(this.ctx.hasPoints=!0),this instanceof Suica.Group);else{if(this.ctx.renderMode==Suica.POINT&&this.mode!=Suica.POINT)return;if(this.ctx.renderMode==Suica.NONPOINT&&this.mode==Suica.POINT)return}if(Suica.normalRender||this.interactive){if(this.hollow||this.clipPlanes&&this.clipPlanes.length||(!this.color||this.color.length<4)&&this.ctx.gl.enable(this.ctx.gl.CULL_FACE),Suica.normalRender?this.color&&this.ctx.gl.vertexAttrib3fv(this.ctx.aColor,this.color):this.ctx.gl.vertexAttrib3fv(this.ctx.aColor,this.idColor),this.ctx.pushMatrix(),this.center&&this.ctx.translate(this.center),this.focus){var t=Math.sqrt(this.focus[0]*this.focus[0]+this.focus[1]*this.focus[1]),i=Math.atan2(t,this.focus[2]),e=Math.atan2(this.focus[1],this.focus[0]);this.ctx.zRotate(-e),this.ctx.yRotate(i)}if(this.spin&&this.ctx.zRotate(this.spin),this.getSizes&&this.ctx.scale(this.getSizes()),this.ctx.translate([-this.origin[0],-this.origin[1],-this.origin[2]]),this.ctx.useModelMatrix(),this.clipPlanes){var r=this.clipPlanes.length;r>2&&(r=2),this.ctx.gl.uniform1i(this.ctx.uClipPlanes,r);var a=this.clipPlanes[0];r>1&&(a=a.concat(this.clipPlanes[1])),this.ctx.gl.uniform4fv(this.ctx.uClipPlane,a)}else this.ctx.gl.uniform1i(this.ctx.uClipPlanes,0);switch(this.mode){case Suica.POINT:this.drawPoint.drawMesh(this);break;case Suica.LINE:this.drawLine.drawMesh(this);break;case Suica.SOLID:this.drawSolid.drawMesh(this)}this.ctx.popMatrix(),this.ctx.gl.disable(this.ctx.gl.CULL_FACE)}}},Suica.Object.prototype.custom=function(t){for(var i in t)this[i]=t[i];return this},Suica.Object.prototype.getPosition=function(){var t=this.ctx.matrixMultiply(this.ctx.projectionMatrix,this.ctx.matrixMultiply(this.ctx.viewMatrix,this.ctx.modelMatrix)),i=this.center,e=t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12],r=t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13],a=t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15],o=this.ctx.gl.canvas,s=o.getBoundingClientRect();return e=e*o.width/a/2,r=r*o.height/a/2,[s.left+e+o.width/2+Suica.scrollLeft(),s.top-r+o.height/2+Suica.scrollTop()]},Suica.Image=function(t,i,e){this.ctx=Suica.lastContext,this.url=t,this.scale=i instanceof Array?i:void 0==i?[1,1]:[i,i],this.offset=e instanceof Array?e:[0,0],this.baseScale=null,this.texture=this.ctx.gl.createTexture(),Suica.loadImageForTexture(this.ctx.gl,this.url,this.texture)},Suica.ongoingImageLoads=[],Suica.loadImageForTexture=function(t,i,e){var r=new Image;r.onload=function(){Suica.ongoingImageLoads.splice(Suica.ongoingImageLoads.indexOf(r),1),Suica.textureFinishedLoading(t,i,r,e)},Suica.ongoingImageLoads.push(r),r.src=i},Suica.textureFinishedLoading=function(t,i,e,r){t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.bindTexture(t.TEXTURE_2D,null)},Suica.texturesReady=function(){return 0==Suica.ongoingImageLoads.length},Suica.SolidSquareMesh=function(t){var i=t.gl,e=[0,0,1],r=[0,0],a=[1,0],o=[1,1],s=[0,1],c=[.5,-.5,0],h=[.5,.5,0],n=[-.5,.5,0],u=[-.5,-.5,0],l=new Float32Array([].concat(h,a,e,n,o,e,c,r,e,c,r,e,n,o,e,u,s,e,[]));this.ctx=t,this.length=l.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,l,i.STATIC_DRAW)},Suica.SolidSquareMesh.prototype.drawMesh=function(t){var i=this.ctx.gl,e=t.image&&Suica.texturesReady();i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,8*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.enableVertexAttribArray(this.ctx.aNormal),i.vertexAttribPointer(this.ctx.aNormal,3,i.FLOAT,!1,8*Suica.FLOATS,5*Suica.FLOATS),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,8*Suica.FLOATS,3*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))),i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),i.drawArrays(i.TRIANGLES,0,this.length/8),i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord))},Suica.WireframeSquareMesh=function(t){var i=t.gl,e=[.5,-.5,0],r=[.5,.5,0],a=[-.5,.5,0],o=[-.5,-.5,0],s=new Float32Array([].concat(e,r,a,o));this.ctx=t,this.length=s.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW)},Suica.WireframeSquareMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.disableVertexAttribArray(this.ctx.aNormal),i.uniform1i(this.ctx.uLight,!1)),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,4)):(i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,0,4))},Suica.Square=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,1],this.center=t,this.size=i,this.hollow=!0,this.ctx.wireframeSquareMesh||(this.ctx.wireframeSquareMesh=new Suica.WireframeSquareMesh(this.ctx)),this.ctx.solidSquareMesh||(this.ctx.solidSquareMesh=new Suica.SolidSquareMesh(this.ctx)),this.drawPoint=this.ctx.wireframeSquareMesh,this.drawLine=this.ctx.wireframeSquareMesh,this.drawSolid=this.ctx.solidSquareMesh},Suica.Square.prototype=Object.create(Suica.Object.prototype),Suica.Square.prototype.getSizes=function(){return[this.size,this.size,this.size]},Suica.Rectangle=function(t,i){Suica.Square.apply(this,arguments),this.sizes=i},Suica.Rectangle.prototype=Object.create(Suica.Square.prototype),Suica.Rectangle.prototype.getSizes=function(){return[this.sizes[0],this.sizes[1],0]},Suica.PointMesh=function(t){var i=t.gl,e=new Float32Array([0,0,0,0,0,0]);this.ctx=t,this.length=e.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW)},Suica.PointMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,!1),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord),i.disableVertexAttribArray(this.ctx.aNormal)),i.uniform1f(this.ctx.uPointSize,t.pointSize),i.drawArrays(i.POINTS,0,1)},Suica.Point=function(t){Suica.Object.apply(this,arguments),this.color=[1,.2,.2],this.center=t,this.mode=Suica.POINT,this.ctx.pointMesh||(this.ctx.pointMesh=new Suica.PointMesh(this.ctx)),this.drawPoint=this.ctx.pointMesh,this.drawLine=this.ctx.pointMesh,this.drawSolid=this.ctx.pointMesh},Suica.Point.prototype=Object.create(Suica.Object.prototype),Suica.SolidCubeMesh=function(t){var i=t.gl,e=[1,0,0],r=[0,1,0],a=[0,0,1],o=[-1,0,0],s=[0,-1,0],c=[0,0,-1],h=[0,0],n=[1,0],u=[1,1],l=[0,1],S=[.5,-.5,-.5],f=[.5,-.5,.5],d=[.5,.5,-.5],x=[.5,.5,.5],m=[-.5,.5,-.5],g=[-.5,.5,.5],P=[-.5,-.5,-.5],A=[-.5,-.5,.5],p=new Float32Array([].concat(S,h,e,d,n,e,f,l,e,f,l,e,d,n,e,x,u,e,P,n,o,A,u,o,m,h,o,m,h,o,A,u,o,g,l,o,x,l,r,d,h,r,g,u,r,g,u,r,d,h,r,m,n,r,A,l,s,P,h,s,f,u,s,f,u,s,P,h,s,S,n,s,f,u,a,x,l,a,A,n,a,A,n,a,x,l,a,g,h,a,S,l,c,P,h,c,d,u,c,d,u,c,P,h,c,m,n,c,[]));this.ctx=t,this.length=p.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,p,i.STATIC_DRAW)},Suica.SolidCubeMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;if(i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,8*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender){var e=t.image&&Suica.texturesReady();i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.enableVertexAttribArray(this.ctx.aNormal),i.vertexAttribPointer(this.ctx.aNormal,3,i.FLOAT,!1,8*Suica.FLOATS,5*Suica.FLOATS),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,8*Suica.FLOATS,3*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))}i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),i.drawArrays(i.TRIANGLES,0,this.length/8-(t.hollow?12:0)),i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord))},Suica.WireframeCubeMesh=function(t){var i=t.gl,e=[.5,-.5,-.5],r=[.5,-.5,.5],a=[.5,.5,-.5],o=[.5,.5,.5],s=[-.5,.5,-.5],c=[-.5,.5,.5],h=[-.5,-.5,-.5],n=[-.5,-.5,.5],u=new Float32Array([].concat(e,r,a,o,s,c,h,n));this.ctx=t,this.length=u.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,u,i.STATIC_DRAW)},Suica.WireframeCubeMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.disableVertexAttribArray(this.ctx.aNormal),i.uniform1i(this.ctx.uLight,!1)),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,8)):(i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINES,0,8),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,6*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,0,4),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,6*Suica.FLOATS,3*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,0,4))},Suica.Cube=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,1],this.center=t,this.size=i,this.ctx.wireframeCubeMesh||(this.ctx.wireframeCubeMesh=new Suica.WireframeCubeMesh(this.ctx)),this.ctx.solidCubeMesh||(this.ctx.solidCubeMesh=new Suica.SolidCubeMesh(this.ctx)),this.drawPoint=this.ctx.wireframeCubeMesh,this.drawLine=this.ctx.wireframeCubeMesh,this.drawSolid=this.ctx.solidCubeMesh},Suica.Cube.prototype=Object.create(Suica.Object.prototype),Suica.Cube.prototype.getSizes=function(){return[this.size,this.size,this.size]},Suica.Cuboid=function(t,i){Suica.Cube.apply(this,arguments),this.sizes=i},Suica.Cuboid.prototype=Object.create(Suica.Cube.prototype),Suica.Cuboid.prototype.getSizes=function(){return this.sizes},Suica.PRECISION_CIRCLE=Suica.PRECISION,Suica.SolidPolygonMesh=function(t,i){for(var e=t.gl,r=[0,0,0],a=0,o=2*Math.PI/i,s=0;i+1>s;s++)r.push(.5*Math.cos(a),.5*Math.sin(a),0),a+=o;var c=new Float32Array(r);this.ctx=t,this.length=c.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW)},Suica.SolidPolygonMesh.prototype.drawMesh=function(t){var i=this.ctx.gl,e=t.image&&Suica.texturesReady();i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.disableVertexAttribArray(this.ctx.aNormal),i.vertexAttrib3f(this.ctx.aNormal,0,0,1),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))),i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),i.drawArrays(i.TRIANGLE_FAN,0,this.count+2),i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord))
},Suica.WireframePolygonMesh=function(t,i){for(var e=t.gl,r=[],a=0,o=2*Math.PI/i,s=0;i>s;s++)r.push(.5*Math.cos(a),.5*Math.sin(a),0),a+=o;var c=new Float32Array(r);this.ctx=t,this.length=c.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW)},Suica.WireframePolygonMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.disableVertexAttribArray(this.ctx.aNormal),i.uniform1i(this.ctx.uLight,!1)),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,this.count)):(i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,0,this.count))},Suica.Polygon=function(t,i,e){Suica.Object.apply(this,arguments),this.color=[0,.5,1],this.center=t,i&&(this.radius=i),this.count=e?e:Suica.PRECISION_CIRCLE,this.hollow=!0,this.ctx.wireframePolygonMesh||(this.ctx.wireframePolygonMesh=[]),this.ctx.wireframePolygonMesh[e]||(this.ctx.wireframePolygonMesh[e]=new Suica.WireframePolygonMesh(this.ctx,e)),this.ctx.solidPolygonMesh||(this.ctx.solidPolygonMesh=[]),this.ctx.solidPolygonMesh[e]||(this.ctx.solidPolygonMesh[e]=new Suica.SolidPolygonMesh(this.ctx,e)),this.drawPoint=this.ctx.wireframePolygonMesh[e],this.drawLine=this.ctx.wireframePolygonMesh[e],this.drawSolid=this.ctx.solidPolygonMesh[e]},Suica.Polygon.prototype=Object.create(Suica.Object.prototype),Suica.Polygon.prototype.getSizes=function(){return[this.radius,this.radius,1]},Suica.Circle=function(t,i){Suica.Polygon.call(this,t,i,Suica.PRECISION_CIRCLE)},Suica.Circle.prototype=Object.create(Suica.Polygon.prototype),Suica.Circle.prototype.getSizes=function(){return[this.radius,this.radius,1]},Suica.Ellipse=function(t,i){Suica.Polygon.call(this,t,void 0,Suica.PRECISION_CIRCLE),this.radii=i},Suica.Ellipse.prototype=Object.create(Suica.Polygon.prototype),Suica.Ellipse.prototype.getSizes=function(){return[this.radii[0],this.radii[1],1]},Suica.PRECISION_CONE=8*Math.floor(Suica.PRECISION/8),Suica.PRECISION_CONE_WF=Suica.PRECISION_CONE/8,Suica.SolidPyramidMesh=function(t,i){for(var e=t.gl,r=[],a=0,o=2*Math.PI/i,s=0,c=1/i,h=0;i>h;h++){var n=Math.cos(a),u=Math.sin(a),l=Math.cos(a+o/2),S=Math.sin(a+o/2),f=Math.cos(a+o),d=Math.sin(a+o);r.push(0,0,1,s+c/2,1,l,S,1),r.push(.5*n,.5*u,0,s,0),i==Suica.PRECISION_CONE?r.push(n,u,0):r.push(l,S,0),r.push(.5*f,.5*d,0,s+c,0),i==Suica.PRECISION_CONE?r.push(f,d,0):r.push(l,S,0),a+=o,s+=c}a=0,s=0;for(var h=0;i>h;h++){var n=Math.cos(a),u=Math.sin(a),f=Math.cos(a+o),d=Math.sin(a+o);r.push(.5*f,.5*d,0,s+c,0,0,0,-1),r.push(.5*n,.5*u,0,s,0,0,0,-1),r.push(0,0,0,s+c/2,1,0,0,-1),a+=o,s+=c}var x=new Float32Array(r);this.ctx=t,this.length=x.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,x,e.STATIC_DRAW)},Suica.SolidPyramidMesh.prototype.drawMesh=function(t){var i=this.ctx.gl,e=t.image&&Suica.texturesReady();i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,8*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.enableVertexAttribArray(this.ctx.aNormal),i.vertexAttribPointer(this.ctx.aNormal,3,i.FLOAT,!1,8*Suica.FLOATS,5*Suica.FLOATS),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,8*Suica.FLOATS,3*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))),i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),i.drawArrays(i.TRIANGLES,0,3*this.count),t.hollow||(e&&t.image.baseScale&&Suica.normalRender&&i.uniform2fv(this.ctx.uTexScale,t.image.baseScale),i.drawArrays(i.TRIANGLES,3*this.count,3*this.count)),i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord))},Suica.WireframePyramidMesh=function(t,i){var e=t.gl,r=[],a=0,o=2*Math.PI/i;r.push(0,0,1);for(var s=0;i>s;s++)r.push(.5*Math.cos(a),.5*Math.sin(a),0),a+=o;this.edgeCount=i==Suica.PRECISION_CONE?Suica.PRECISION_CONE_WF:i;for(var a=0,s=0;s<this.edgeCount;s++){var c=Math.cos(a),h=Math.sin(a);r.push(.5*c,.5*h,0),r.push(0,0,1),a+=o*i/this.edgeCount}var n=new Float32Array(r);this.ctx=t,this.length=n.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)},Suica.WireframePyramidMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,!1),i.disableVertexAttribArray(this.ctx.aNormal)),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,this.count+1)):(i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,1,this.count),i.drawArrays(i.LINES,this.count+1,2*this.edgeCount))},Suica.Pyramid=function(t,i,e,r){Suica.Object.apply(this,arguments),this.color=[1,0,.5],this.center=t,i&&(this.radius=i),this.height=e,this.count=r?r:Suica.PRECISION_CONE,this.ctx.wireframePyramidMesh||(this.ctx.wireframePyramidMesh=[]),this.ctx.wireframePyramidMesh[r]||(this.ctx.wireframePyramidMesh[r]=new Suica.WireframePyramidMesh(this.ctx,r)),this.ctx.solidPyramidMesh||(this.ctx.solidPyramidMesh=[]),this.ctx.solidPyramidMesh[r]||(this.ctx.solidPyramidMesh[r]=new Suica.SolidPyramidMesh(this.ctx,r)),this.drawPoint=this.ctx.wireframePyramidMesh[r],this.drawLine=this.ctx.wireframePyramidMesh[r],this.drawSolid=this.ctx.solidPyramidMesh[r]},Suica.Pyramid.prototype=Object.create(Suica.Object.prototype),Suica.Pyramid.prototype.getSizes=function(){return[this.radius,this.radius,this.height]},Suica.Cone=function(t,i,e){Suica.Pyramid.call(this,t,i,e,Suica.PRECISION_CONE)},Suica.Cone.prototype=Object.create(Suica.Pyramid.prototype),Suica.Cone.prototype.getSizes=function(){return[this.radius,this.radius,this.height]},Suica.Conoid=function(t,i,e){Suica.Pyramid.call(this,t,void 0,e,Suica.PRECISION_CONE),this.radii=i},Suica.Conoid.prototype=Object.create(Suica.Pyramid.prototype),Suica.Conoid.prototype.getSizes=function(){return[this.radii[0],this.radii[1],this.height]},Suica.PRECISION_CYLINDER=8*Math.floor(Suica.PRECISION/8),Suica.PRECISION_CYLINDER_WF=Suica.PRECISION_CYLINDER/8,Suica.SolidPrismMesh=function(t,i){for(var e=t.gl,r=[],a=0,o=2*Math.PI/i,s=0,c=1/i,h=0;i>h;h++){var n,u,l,S,f=Math.cos(a),d=Math.sin(a),x=Math.cos(a+o/2),m=Math.sin(a+o/2),g=Math.cos(a+o),P=Math.sin(a+o);i==Suica.PRECISION_CYLINDER?(n=f,u=g,l=d,S=P):(n=x,u=x,l=m,S=m),r.push(.5*f,.5*d,1,s,1,n,l,0),r.push(.5*f,.5*d,0,s,0,n,l,0),r.push(.5*g,.5*P,0,s+c,0,u,S,0),r.push(.5*f,.5*d,1,s,1,n,l,0),r.push(.5*g,.5*P,0,s+c,0,u,S,0),r.push(.5*g,.5*P,1,s+c,1,u,S,0),a+=o,s+=c}a=0,s=0;for(var h=0;i>h;h++){var f=Math.cos(a),d=Math.sin(a),g=Math.cos(a+o),P=Math.sin(a+o);r.push(.5*f,.5*d,1,s,0,0,0,1),r.push(.5*g,.5*P,1,s+c,0,0,0,1),r.push(0,0,1,s+c/2,1,0,0,1),a+=o,s+=c}a=0,s=0;for(var h=0;i>h;h++){var f=Math.cos(a),d=Math.sin(a),g=Math.cos(a+o),P=Math.sin(a+o);r.push(.5*g,.5*P,0,s+c,0,0,0,-1),r.push(.5*f,.5*d,0,s,0,0,0,-1),r.push(0,0,0,s+c/2,1,0,0,-1),a+=o,s+=c}var A=new Float32Array(r);this.ctx=t,this.length=A.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,A,e.STATIC_DRAW)},Suica.SolidPrismMesh.prototype.drawMesh=function(t){var i=this.ctx.gl,e=t.image&&Suica.texturesReady();i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,8*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.enableVertexAttribArray(this.ctx.aNormal),i.vertexAttribPointer(this.ctx.aNormal,3,i.FLOAT,!1,8*Suica.FLOATS,5*Suica.FLOATS),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,8*Suica.FLOATS,3*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))),i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),i.drawArrays(i.TRIANGLES,0,6*this.count),t.hollow||(e&&t.image.baseScale&&i.uniform2fv(this.ctx.uTexScale,t.image.baseScale),i.drawArrays(i.TRIANGLES,6*this.count,3*this.count),i.drawArrays(i.TRIANGLES,9*this.count,3*this.count)),i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord))},Suica.WireframePrismMesh=function(t,i){for(var e=t.gl,r=[],a=0,o=2*Math.PI/i,s=0;i>s;s++)r.push(.5*Math.cos(a),.5*Math.sin(a),0),a+=o;for(var s=0;i>s;s++)r.push(.5*Math.cos(a),.5*Math.sin(a),1),a+=o;this.edgeCount=i==Suica.PRECISION_CYLINDER?Suica.PRECISION_CYLINDER_WF:i;for(var s=0;s<this.edgeCount;s++){var c=Math.cos(a),h=Math.sin(a);r.push(.5*c,.5*h,0),r.push(.5*c,.5*h,1),a+=o*i/this.edgeCount}var n=new Float32Array(r);this.ctx=t,this.length=n.length,this.buffer=e.createBuffer(),this.count=i,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)},Suica.WireframePrismMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.disableVertexAttribArray(this.ctx.aNormal),i.uniform1i(this.ctx.uLight,!1)),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,2*this.count)):(i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.LINE_LOOP,0,this.count),i.drawArrays(i.LINE_LOOP,this.count,this.count),i.drawArrays(i.LINES,2*this.count,2*this.edgeCount))},Suica.Prism=function(t,i,e,r){Suica.Object.apply(this,arguments),this.color=[1,0,.5],this.center=t,i&&(this.radius=i),this.height=e,this.count=r?r:Suica.PRECISION_CYLINDER,this.ctx.wireframePrismMesh||(this.ctx.wireframePrismMesh=[]),this.ctx.wireframePrismMesh[r]||(this.ctx.wireframePrismMesh[r]=new Suica.WireframePrismMesh(this.ctx,r)),this.ctx.solidPrismMesh||(this.ctx.solidPrismMesh=[]),this.ctx.solidPrismMesh[r]||(this.ctx.solidPrismMesh[r]=new Suica.SolidPrismMesh(this.ctx,r)),this.drawPoint=this.ctx.wireframePrismMesh[r],this.drawLine=this.ctx.wireframePrismMesh[r],this.drawSolid=this.ctx.solidPrismMesh[r]},Suica.Prism.prototype=Object.create(Suica.Object.prototype),Suica.Prism.prototype.getSizes=function(){return[this.radius,this.radius,this.height]},Suica.Cylinder=function(t,i,e){Suica.Prism.call(this,t,i,e,Suica.PRECISION_CYLINDER)},Suica.Cylinder.prototype=Object.create(Suica.Object.prototype),Suica.Cylinder.prototype.getSizes=function(){return[this.radius,this.radius,this.height]},Suica.Cylindroid=function(t,i,e){Suica.Cylinder.call(this,t,void 0,e,Suica.PRECISION_CYLINDER),this.radii=i},Suica.Cylindroid.prototype=Object.create(Suica.Prism.prototype),Suica.Cylindroid.prototype.getSizes=function(){return[this.radii[0],this.radii[1],this.height]},Suica.WireframeSegmentMesh=function(t){var i=t.gl;this.ctx=t,this.mesh=new Float32Array([0,0,0,0,0,0]),this.length=this.mesh.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,this.mesh,i.DYNAMIC_DRAW)},Suica.WireframeSegmentMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;Suica.normalRender&&(i.uniform1i(this.ctx.uLight,!1),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord),i.disableVertexAttribArray(this.ctx.aNormal)),i.uniform1f(this.ctx.uPointSize,t.pointSize),this.mesh[0]=t.from[0],this.mesh[1]=t.from[1],this.mesh[2]=t.from[2],this.mesh[3]=t.to[0],this.mesh[4]=t.to[1],this.mesh[5]=t.to[2],i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.mesh),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.drawArrays(i.POINTS,0,2)):i.drawArrays(i.LINES,0,2)},Suica.Segment=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,0],this.from=t,this.to=i,this.mode=Suica.LINE,this.ctx.segmentMesh||(this.ctx.segmentMesh=new Suica.WireframeSegmentMesh(this.ctx)),this.drawPoint=this.ctx.segmentMesh,this.drawLine=this.ctx.segmentMesh,this.drawSolid=this.ctx.segmentMesh},Suica.Segment.prototype=Object.create(Suica.Object.prototype),Suica.WireframeLineMesh=function(t,i,e){var r=t.gl;this.kFrom=i,this.kTo=e,this.ctx=t,this.mesh=new Float32Array([0,0,0,0,0,0]),this.length=this.mesh.length,this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferData(r.ARRAY_BUFFER,this.mesh,r.DYNAMIC_DRAW)},Suica.WireframeLineMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;Suica.normalRender&&(i.uniform1i(this.ctx.uLight,!1),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord),i.disableVertexAttribArray(this.ctx.aNormal)),i.uniform1f(this.ctx.uPointSize,t.pointSize);var e=unitVector(vectorPoints(t.from,t.to));this.mesh[0]=t.from[0]-this.kFrom*e[0],this.mesh[1]=t.from[1]-this.kFrom*e[1],this.mesh[2]=t.from[2]-this.kFrom*e[2],this.mesh[3]=t.to[0]+this.kTo*e[0],this.mesh[4]=t.to[1]+this.kTo*e[1],this.mesh[5]=t.to[2]+this.kTo*e[2],i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.mesh),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),t.mode==Suica.POINT?(i.uniform1f(this.ctx.uPointSize,t.pointSize),i.drawArrays(i.POINTS,0,2)):i.drawArrays(i.LINES,0,2)},Suica.Line=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,0],this.from=t,this.to=i,this.mode=Suica.LINE,this.ctx.lineMesh||(this.ctx.lineMesh=new Suica.WireframeLineMesh(this.ctx,1e6,1e6)),this.drawPoint=this.ctx.lineMesh,this.drawLine=this.ctx.lineMesh,this.drawSolid=this.ctx.lineMesh},Suica.Line.prototype=Object.create(Suica.Object.prototype),Suica.Ray=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,0],this.from=t,this.to=i,this.mode=Suica.LINE,this.ctx.rayMesh||(this.ctx.rayMesh=new Suica.WireframeLineMesh(this.ctx,0,1e6)),this.drawPoint=this.ctx.rayMesh,this.drawLine=this.ctx.rayMesh,this.drawSolid=this.ctx.rayMesh},Suica.Ray.prototype=Object.create(Suica.Object.prototype),Suica.Segment=function(t,i){Suica.Object.apply(this,arguments),this.color=[0,.5,0],this.from=t,this.to=i,this.mode=Suica.LINE,this.ctx.segmentMesh||(this.ctx.segmentMesh=new Suica.WireframeLineMesh(this.ctx,0,0)),this.drawPoint=this.ctx.segmentMesh,this.drawLine=this.ctx.segmentMesh,this.drawSolid=this.ctx.segmentMesh},Suica.Segment.prototype=Object.create(Suica.Object.prototype),Suica.PRECISION_SPHERE_U=4*Math.floor(Suica.PRECISION/4),Suica.PRECISION_SPHERE_V=Suica.PRECISION_SPHERE_U/2,Suica.PRECISION_SPHERE_WF_U=Suica.PRECISION_SPHERE_U/4,Suica.PRECISION_SPHERE_WF_V=Suica.PRECISION_SPHERE_WF_U/2,Suica.SolidSphereMesh=function(t){for(var i=t.gl,e=[],r=-Math.PI/2,a=Math.PI/Suica.PRECISION_SPHERE_V,o=0,s=1/Suica.PRECISION_SPHERE_V,c=0;c<Suica.PRECISION_SPHERE_V;c++){for(var h=0,n=2*Math.PI/Suica.PRECISION_SPHERE_U,u=0,l=1/Suica.PRECISION_SPHERE_U,S=0;S<Suica.PRECISION_SPHERE_U+1;S++){var f=.5*Math.cos(h)*Math.cos(r+a),d=.5*Math.sin(h)*Math.cos(r+a),x=.5*Math.sin(r+a);e.push(f,d,x,u,o+s,f,d,x),f=.5*Math.cos(h)*Math.cos(r),d=.5*Math.sin(h)*Math.cos(r),x=.5*Math.sin(r),e.push(f,d,x,u,o+s,f,d,x),h+=n,u+=l}r+=a,o+=s}var m=new Float32Array(e);this.ctx=t,this.length=m.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,m,i.STATIC_DRAW)},Suica.SolidSphereMesh.prototype.drawMesh=function(t){var i=this.ctx.gl,e=t.image&&Suica.texturesReady();i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,8*Suica.FLOATS,0*Suica.FLOATS),Suica.normalRender&&(i.uniform1i(this.ctx.uLight,t.light),i.uniform1i(this.ctx.uTexture,null!=t.image),i.enableVertexAttribArray(this.ctx.aNormal),i.vertexAttribPointer(this.ctx.aNormal,3,i.FLOAT,!1,8*Suica.FLOATS,5*Suica.FLOATS),e&&(i.enableVertexAttribArray(this.ctx.aTexCoord),i.vertexAttribPointer(this.ctx.aTexCoord,2,i.FLOAT,!1,8*Suica.FLOATS,3*Suica.FLOATS),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.image.texture),i.uniform1i(this.ctx.uTexture,!0),i.uniform2fv(this.ctx.uTexScale,t.image.scale),i.uniform2fv(this.ctx.uTexOffset,t.image.offset))),i.enable(i.POLYGON_OFFSET_FILL),i.polygonOffset(1,0),t.radii&&Suica.normalRender&&(this.ctx.transposeInverse(),i.uniformMatrix3fv(this.ctx.uNormalMatrix,!1,this.ctx.normalMatrix),i.uniform1i(this.ctx.uUseNormal,!0));for(var r=0;r<Suica.PRECISION_SPHERE_V;r++)i.drawArrays(i.TRIANGLE_STRIP,(2*Suica.PRECISION_SPHERE_U+2)*r,2*Suica.PRECISION_SPHERE_U+2);i.disable(i.POLYGON_OFFSET_FILL),Suica.normalRender&&(i.uniform1i(this.ctx.uUseNormal,!1),e&&(i.bindTexture(i.TEXTURE_2D,null),i.uniform1i(this.ctx.uTexture,!1),i.disableVertexAttribArray(this.ctx.aTexCoord)))},Suica.WireframeSphereMesh=function(t){for(var i=t.gl,e=[],r=Math.PI/(Suica.PRECISION_SPHERE_WF_V+1),a=-Math.PI/2+r,o=0;o<Suica.PRECISION_SPHERE_WF_V;o++){for(var s=0,c=2*Math.PI/Suica.PRECISION_SPHERE_U,h=0;h<Suica.PRECISION_SPHERE_U+1;h++){var n=.5*Math.cos(s)*Math.cos(a),u=.5*Math.sin(s)*Math.cos(a),l=.5*Math.sin(a);e.push(n,u,l),s+=c}a+=r}for(var s=0,c=Math.PI/Suica.PRECISION_SPHERE_WF_V,h=0;h<Suica.PRECISION_SPHERE_WF_V;h++){for(var r=2*Math.PI/Suica.PRECISION_SPHERE_U,a=0,o=0;o<=Suica.PRECISION_SPHERE_U;o++){var n=.5*Math.cos(s)*Math.cos(a),u=.5*Math.sin(s)*Math.cos(a),l=.5*Math.sin(a);e.push(n,u,l),a+=r}s+=c}var S=new Float32Array(e);this.ctx=t,this.length=S.length,this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,S,i.STATIC_DRAW)},Suica.WireframeSphereMesh.prototype.drawMesh=function(t){var i=this.ctx.gl;if(i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.enableVertexAttribArray(this.ctx.aXYZ),Suica.normalRender&&(i.disableVertexAttribArray(this.ctx.aNormal),i.uniform1i(this.ctx.uLight,!1)),t.mode==Suica.POINT)i.uniform1f(this.ctx.uPointSize,t.pointSize),i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS),i.drawArrays(i.POINTS,0,Suica.PRECISION_SPHERE_U);else{i.vertexAttribPointer(this.ctx.aXYZ,3,i.FLOAT,!1,3*Suica.FLOATS,0*Suica.FLOATS);for(var e=0;e<Suica.PRECISION_SPHERE_WF_V;e++)i.drawArrays(i.LINE_LOOP,(Suica.PRECISION_SPHERE_U+1)*e,Suica.PRECISION_SPHERE_U+1);for(var r=(Suica.PRECISION_SPHERE_U+1)*Suica.PRECISION_SPHERE_WF_V,e=0;e<Suica.PRECISION_SPHERE_WF_V;e++)i.drawArrays(i.LINE_LOOP,r+(Suica.PRECISION_SPHERE_U+1)*e,Suica.PRECISION_SPHERE_U+1)}},Suica.Sphere=function(t,i){Suica.Object.apply(this,arguments),this.color=[1,0,.5],this.center=t,i&&(this.radius=i),this.ctx.wireframeSphereMesh||(this.ctx.wireframeSphereMesh=new Suica.WireframeSphereMesh(this.ctx)),this.ctx.solidSphereMesh||(this.ctx.solidSphereMesh=new Suica.SolidSphereMesh(this.ctx)),this.drawPoint=this.ctx.wireframeSphereMesh,this.drawLine=this.ctx.wireframeSphereMesh,this.drawSolid=this.ctx.solidSphereMesh},Suica.Sphere.prototype=Object.create(Suica.Object.prototype),Suica.Sphere.prototype.getSizes=function(){return[this.radius,this.radius,this.radius]},Suica.Spheroid=function(t,i){Suica.Sphere.call(this,t,void 0),this.radii=i},Suica.Spheroid.prototype=Object.create(Suica.Sphere.prototype),Suica.Spheroid.prototype.getSizes=function(){return[this.radii[0],this.radii[1],this.radii[2]]},Suica.GroupMesh=function(t){this.ctx=t},Suica.GroupMesh.prototype.drawMesh=function(t){for(var i in t.elements)t.elements[i].drawObject()},Suica.Group=function(t){Suica.Object.apply(this,arguments),this.color=[.5,.5,.5],this.center=[0,0,0],this.sizes=[1,1,1],this.elements=t?t:[];for(var i in t)Suica.lastContext.objectList=Suica.lastContext.objectList.filter(function(e){return e!==t[i]});this.drawGroup=new Suica.GroupMesh(this.ctx),this.drawPoint=this.drawGroup,this.drawLine=this.drawGroup,this.drawSolid=this.drawGroup},Suica.Group.prototype=Object.create(Suica.Object.prototype),Suica.Group.prototype.getSizes=function(){return this.sizes},Suica.Group.prototype.add=function(t){this.elements.push(t),this.ctx.objectList=this.ctx.objectList.filter(function(i){return i!==t})},Suica.Group.prototype.merge=function(){for(var t in this.elements)this.elements[t].id=this.id,this.elements[t].idColor=this.idColor,this.elements[t].interactive=this.interactive},Suica.Group.prototype.mergeColor=function(){for(var t in this.elements)delete this.elements[t].color};