document.write('<script src="three.min.js" onload="LoadSuica();"></script>');﻿function LoadSuica(){﻿
console.log(`Suica 2.-1.16 (220209)`);const DEBUG_CALLS=!false;class Suica
{static current;static allSuicas=[];static ORIENTATIONS={XYZ:{SCALE:new THREE.Vector3(1,1,1),UP:new THREE.Vector3(0,1,0)},XZY:{SCALE:new THREE.Vector3(-1,1,1),UP:new THREE.Vector3(0,0,1)},YXZ:{SCALE:new THREE.Vector3(1,-1,1),UP:new THREE.Vector3(1,0,0)},YZX:{SCALE:new THREE.Vector3(1,1,1),UP:new THREE.Vector3(0,0,1)},ZXY:{SCALE:new THREE.Vector3(1,1,1),UP:new THREE.Vector3(1,0,0)},ZYX:{SCALE:new THREE.Vector3(1,1,-1),UP:new THREE.Vector3(0,1,0)},}
static DEFAULT={BACKGROUND:{COLOR:'whitesmoke'},ORIENTATION:'XYZ',SIZE:'30',OXYZ:{COLOR:'black',SIZE:30},DEMO:{DISTANCE:100,ALTITUDE:30},ONTIME:{SRC:null},POINT:{CENTER:[0,0,0],COLOR:'crimson',SIZE:7},LINE:{CENTER:[0,0,0],COLOR:'black',TO:[0,30,0]},CUBE:{CENTER:[0,0,0],COLOR:'cornflowerblue',FRAMECOLOR:'black',SIZE:30},SQUARE:{CENTER:[0,0,0],COLOR:'cornflowerblue',FRAMECOLOR:'black',SIZE:30},CIRCLE:{CENTER:[0,0,0],COLOR:'cornflowerblue',FRAMECOLOR:'black',SIZE:30,COUNT:50},POLYGON:{CENTER:[0,0,0],COLOR:'cornflowerblue',FRAMECOLOR:'black',SIZE:30,COUNT:3},SPHERE:{CENTER:[0,0,0],COLOR:'cornflowerblue',SIZE:30,COUNT:50},CYLINDER:{CENTER:[0,0,0],COLOR:'cornflowerblue',SIZE:30,COUNT:50,RATIO:1},CONE:{CENTER:[0,0,0],COLOR:'cornflowerblue',SIZE:30,COUNT:50,RATIO:0},PRISM:{CENTER:[0,0,0],COLOR:'cornflowerblue',SIZE:30,COUNT:6,RATIO:1},PYRAMID:{CENTER:[0,0,0],COLOR:'cornflowerblue',SIZE:30,COUNT:6,RATIO:0},}
constructor(suicaTag)
{suicaTag.style.display='inline-block';suicaTag.style.boxSizing='border-box';this.id=suicaTag.getAttribute('id')||`suica${Suica.allSuicas.length}`
if(DEBUG_CALLS)console.log(`Suica :: ${this.id}`);this.suicaTag=suicaTag;this.orientation=Suica.ORIENTATIONS[suicaTag.getAttribute('ORIENTATION')?.toUpperCase()||Suica.DEFAULT.ORIENTATION];this.createCanvas();this.createRenderer();this.parser=new HTMLParser(this);this.onTimeHandler=null;this.demoViewPoint=null;Suica.current=this;Suica.allSuicas.push(this);window[this.id]=this;}
createCanvas()
{if(this.suicaTag.clientWidth<1)
this.suicaTag.style.width=(this.suicaTag.getAttribute('width')||500)+'px';if(this.suicaTag.clientHeight<1)
this.suicaTag.style.height=(this.suicaTag.getAttribute('height')||300)+'px';this.canvas=document.createElement('canvas');this.canvas.width=this.suicaTag.clientWidth;this.canvas.height=this.suicaTag.clientHeight;this.canvas.style=` border: solid 1px gray;

        width: 100%;

        height: 100%;

        box-sizing: border-box;`;this.suicaTag.appendChild(this.canvas);}
get canvasAspect()
{return this.canvas.width/this.canvas.height;}
render()
{this.renderer.render(this.scene,this.camera);}
createRenderer()
{this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:true,antialias:true});this.scene=new THREE.Scene();this.scene.scale.copy(this.orientation.SCALE);var color=getComputedStyle(this.suicaTag).backgroundColor;if(color=='rgba(0, 0, 0, 0)')
{color=this.suicaTag.getAttribute('background')||Suica.DEFAULT.BACKGROUND.COLOR;}
this.scene.background=Suica.parseColor(color);this.camera=new THREE.PerspectiveCamera(40,this.canvasAspect,1,1000);this.camera.up.copy(this.orientation.UP);this.camera.position.set(0,0,100);this.camera.lookAt(this.scene.position);this.light=new THREE.PointLight('white',0.5);this.light.position.set(1000,1500,3000);this.scene.add(this.light);this.scene.add(new THREE.AmbientLight('white',0.5));var that=this;this.lastTime=0;function loop(time)
{time/=1000;if(that.demoViewPoint)
{var x=that.demoViewPoint.distance*Math.cos(time),y=that.demoViewPoint.altitude,z=that.demoViewPoint.distance*Math.sin(time),p=that.camera.position;switch(that.orientation)
{case Suica.ORIENTATIONS.XYZ:p.set(x,y,-z);break;case Suica.ORIENTATIONS.XZY:p.set(-x,-z,y);break;case Suica.ORIENTATIONS.YXZ:p.set(y,-x,-z);break;case Suica.ORIENTATIONS.YZX:p.set(-z,x,y);break;case Suica.ORIENTATIONS.ZXY:p.set(y,-z,x);break;case Suica.ORIENTATIONS.ZYX:p.set(-z,y,-x);break;default:throw'error: Unknown orientation in <suica>';};that.camera.lookAt(that.scene.position);that.light.position.copy(that.camera.position);}
if(that.onTimeHandler)
{if(typeof that.onTimeHandler==='string'||that.onTimeHandler instanceof String)
that.onTimeHandler=window[that.onTimeHandler];that.onTimeHandler(time,time-that.lastTime);}
that.render();that.lastTime=time;}
this.renderer.setAnimationLoop(loop);}
background(color=Suica.DEFAULT.BACKGROUND.COLOR)
{this.parser?.parseTags();this.debugCall('background',color);this.scene.background=new THREE.Color(color);}
oxyz(size=Suica.DEFAULT.OXYZ.SIZE,color=Suica.DEFAULT.OXYZ.COLOR)
{this.parser?.parseTags();this.debugCall('oxyz',size,color);var axes=new THREE.AxesHelper(size)
axes.setColors(color,color,color);this.scene.add(axes);}
demo(distance=Suica.DEFAULT.DEMO.DISTANCE,altitude=Suica.DEFAULT.DEMO.ALTITUDE)
{this.parser?.parseTags();this.debugCall('demo',distance,altitude);this.demoViewPoint={distance:distance,altitude:altitude};}
onTime(src=Suica.DEFAULT.ONTIME.SRC)
{this.parser?.parseTags();this.debugCall('onTime',src);this.onTimeHandler=src;}
static precheck()
{if(!(Suica.current instanceof Suica))
throw'error: No Suica instance is active';}
debugCall(functionName,...parameters)
{if(!DEBUG_CALLS)return;for(var i=0;i<parameters.length;i++)
{if(Array.isArray(parameters[i]))
parameters[i]=`[${parameters[i]}]`;else
if(typeof parameters[i]==='string'||parameters[i]instanceof String)
parameters[i]=`'${parameters[i]}'`;else
parameters[i]=''+parameters[i];}
console.info(`:: ${this.id}.${functionName}(${parameters.join(',')})`);}
static parseColor(color)
{if(color instanceof THREE.Color)
return color;if(Array.isArray(color))
return new THREE.Color(color[0],color[1]||0,color[2]||0);if(typeof color==='string'||color instanceof String)
{color=color.toLowerCase().replaceAll(' ','');if(color[0]=='0'&&color[1]=='x')
return new THREE.Color(Number(color));if(color[0]=='r'&&color[1]=='g'&&color[2]=='b')
return new THREE.Color(color);if(color[0]=='h'&&color[1]=='s'&&color[2]=='l')
{color=color.substring(4).split(',');return hsl(parseFloat(color[0]),parseFloat(color[1]),parseFloat(color[2]));}
if(color.indexOf(',')>0)
{color=color.split(',');return new THREE.Color(Number(color[0]),Number(color[1]),Number(color[2]));}}
return new THREE.Color(color||'white');}
static parseCenter(center)
{if(center.center)
return center.center;if(Array.isArray(center))
return center;if(typeof center==='string'||center instanceof String)
{center=center.replaceAll(' ','');if(center.indexOf(',')>0)
{center=center.split(',').map(Number);return[Number(center[0]),Number(center[1]),Number(center[2])];}
if(window[center]&&window[center].center)
{return window[center].center;}}
return center;}
static parseSize(size)
{if(typeof size==='string'||size instanceof String)
{size=size.replaceAll(' ','');if(size.indexOf(',')>0)
{return size.split(',').map(Number);}}
return size;}
static parseRadius(radius)
{if(typeof radius==='string'||radius instanceof String)
{radius=radius.replaceAll(' ','');if(radius.indexOf(',')>0)
{return radius.split(',').map(Number);}}
return radius;}
static parseColorTest()
{function test(color)
{var parsedColor=Suica.parseColor(color);if(parsedColor.r==1&&parsedColor.g==0&&parsedColor.b==0)
return null;return color;}
var testValues=['red','Red','RED',0xFF0000,0XFF0000,'0XFF0000','0xFF0000','0xff0000','0Xff0000',[1,0,0],'1,0,0','1, 0, 0','rgb(255,0,0)','rgb( 255, 0, 0)',' rgb ( 255 , 0 , 0 ) ','RGB( 255, 0, 0 )',rgb(255,0,0),'hsl(0,100,50)','hsl( 0, 100, 50 )',' hsl ( 0 , 100 , 50 ) ','HSL( 0, 100, 50 )',hsl(0,100,50),new THREE.Color('red')]
var summary=[];for(var value of testValues)
{var result=test(value);if(result)summary.push(result);}
if(summary.length)
console.log(`Suica::parseColorTest() - failed at: \n\t|${summary.join('|\n\t|')}|`);else
console.log(`Suica::parseColorTest() - passed OK`);}
point(center=Suica.DEFAULT.POINT.CENTER,size=Suica.DEFAULT.POINT.SIZE,color=Suica.DEFAULT.POINT.COLOR)
{this.parser?.parseTags();return new Point(this,center,size,color);}
line(center=Suica.DEFAULT.LINE.CENTER,to=Suica.DEFAULT.LINE.TO,color=Suica.DEFAULT.LINE.COLOR)
{this.parser?.parseTags();return new Line(this,center,to,color);}
square(center=Suica.DEFAULT.SQUARE.CENTER,size=Suica.DEFAULT.SQUARE.SIZE,color=Suica.DEFAULT.SQUARE.COLOR)
{this.parser?.parseTags();return new Square(this,center,size,color);}
squareFrame(center=Suica.DEFAULT.SQUARE.CENTER,size=Suica.DEFAULT.SQUARE.SIZE,color=Suica.DEFAULT.SQUARE.FRAMECOLOR)
{this.parser?.parseTags();return new SquareFrame(this,center,size,color);}
cube(center=Suica.DEFAULT.CUBE.CENTER,size=Suica.DEFAULT.CUBE.SIZE,color=Suica.DEFAULT.CUBE.COLOR)
{this.parser?.parseTags();return new Cube(this,center,size,color);}
cubeFrame(center=Suica.DEFAULT.CUBE.CENTER,size=Suica.DEFAULT.CUBE.SIZE,color=Suica.DEFAULT.CUBE.FRAMECOLOR)
{this.parser?.parseTags();return new CubeFrame(this,center,size,color);}
circle(center=Suica.DEFAULT.CIRCLE.CENTER,size=Suica.DEFAULT.CIRCLE.SIZE,color=Suica.DEFAULT.CIRCLE.COLOR)
{this.parser?.parseTags();return new Polygon(this,Suica.DEFAULT.CIRCLE.COUNT,center,size,color);}
circleFrame(center=Suica.DEFAULT.CIRCLE.CENTER,size=Suica.DEFAULT.CIRCLE.SIZE,color=Suica.DEFAULT.CIRCLE.FRAMECOLOR)
{this.parser?.parseTags();return new PolygonFrame(this,Suica.DEFAULT.CIRCLE.COUNT,center,size,color);}
polygon(count=Suica.DEFAULT.POLYGON.COUNT,center=Suica.DEFAULT.POLYGON.CENTER,size=Suica.DEFAULT.POLYGON.SIZE,color=Suica.DEFAULT.CIRCLE.COLOR)
{this.parser?.parseTags();return new Polygon(this,count,center,size,color);}
polygonFrame(count=Suica.DEFAULT.POLYGON.COUNT,center=Suica.DEFAULT.CIRCLE.CENTER,size=Suica.DEFAULT.CIRCLE.SIZE,color=Suica.DEFAULT.CIRCLE.FRAMECOLOR)
{this.parser?.parseTags();return new PolygonFrame(this,count,center,size,color);}
sphere(center=Suica.DEFAULT.SPHERE.CENTER,size=Suica.DEFAULT.SPHERE.SIZE,color=Suica.DEFAULT.SPHERE.COLOR)
{this.parser?.parseTags();return new Sphere(this,center,size,color);}
cylinder(center=Suica.DEFAULT.CYLINDER.CENTER,size=Suica.DEFAULT.CYLINDER.SIZE,color=Suica.DEFAULT.CYLINDER.COLOR)
{this.parser?.parseTags();return new Prism(this,Suica.DEFAULT.CYLINDER.COUNT,center,size,color,false);}
prism(count=Suica.DEFAULT.PRISM.COUNT,center=Suica.DEFAULT.PRISM.CENTER,size=Suica.DEFAULT.PRISM.SIZE,color=Suica.DEFAULT.PRISM.COLOR)
{this.parser?.parseTags();return new Prism(this,count,center,size,color,true);}
prismFrame(count=Suica.DEFAULT.PRISM.COUNT,center=Suica.DEFAULT.PRISM.CENTER,size=Suica.DEFAULT.PRISM.SIZE,color=Suica.DEFAULT.PRISM.FRAMECOLOR)
{this.parser?.parseTags();return new PrismFrame(this,count,center,size,color);}
cone(center=Suica.DEFAULT.CONE.CENTER,size=Suica.DEFAULT.CONE.SIZE,color=Suica.DEFAULT.CONE.COLOR)
{this.parser?.parseTags();return new Pyramid(this,Suica.DEFAULT.CONE.COUNT,center,size,color,false);}
pyramid(count=Suica.DEFAULT.PYRAMID.COUNT,center=Suica.DEFAULT.PYRAMID.CENTER,size=Suica.DEFAULT.PYRAMID.SIZE,color=Suica.DEFAULT.PYRAMID.COLOR)
{this.parser?.parseTags();return new Pyramid(this,count,center,size,color,true);}
pyramidFrame(count=Suica.DEFAULT.PYRAMID.COUNT,center=Suica.DEFAULT.PYRAMID.CENTER,size=Suica.DEFAULT.PYRAMID.SIZE,color=Suica.DEFAULT.PYRAMID.FRAMECOLOR)
{this.parser?.parseTags();return new PyramidFrame(this,count,center,size,color);}}
window.background=function(color=Suica.DEFAULT.BACKGROUND.COLOR)
{Suica.precheck();Suica.current.background(color);}
window.oxyz=function oxyz(size=Suica.DEFAULT.OXYZ.SIZE,color=Suica.DEFAULT.OXYZ.COLOR)
{Suica.precheck();Suica.current.oxyz(size,color);}
window.demo=function(distance=Suica.DEFAULT.DEMO.DISTANCE,altitude=Suica.DEFAULT.DEMO.ALTITUDE)
{Suica.precheck();Suica.current.demo(distance,altitude);}
window.onTime=function(src=Suica.DEFAULT.ONTIME.SRC)
{Suica.precheck();Suica.current.onTime(src);}
window.element=function(id)
{return document.getElementById(id);}
window.rgb=function(r,g,b)
{return new THREE.Color(r/255,g/255,b/255);}
window.hsl=function hsl(h,s,l)
{return new THREE.Color().setHSL(h/360,s/100,l/100);}
window.random=function random(a=0,b=1)
{if(Array.isArray(a))
{return a[THREE.Math.randInt(0,a.length-1)];}
return a+(b-a)*Math.random();}
new MutationObserver(function(mutations)
{for(var parentElem of mutations)
{for(var childElem of parentElem.addedNodes)
{if(childElem?.tagName=='SCRIPT')
for(var suica of Suica.allSuicas)
suica.parser?.parseTags();if(childElem?.tagName=='SUICA')
new Suica(childElem);}
if(parentElem.type=='attributes'&&parentElem.target.suicaObject)
{var name=parentElem.attributeName,value=parentElem.target.getAttribute(parentElem.attributeName);parentElem.target.suicaObject[name]=value;}}}).observe(document,{childList:true,subtree:true,attributes:true});window.addEventListener('load',function()
{for(var suica of Suica.allSuicas)
suica.parser?.parseTags();});﻿
class HTMLParser
{constructor(suica)
{this.suica=suica;this.parseTag={};this.parseTag.OXYZ=this.parseTagOXYZ;this.parseTag.DEMO=this.parseTagDEMO;this.parseTag.BACKGROUND=this.parseTagBACKGROUND;this.parseTag.ONTIME=this.parseTagONTIME;this.parseTag.POINT=this.parseTagPOINT;this.parseTag.LINE=this.parseTagLINE;this.parseTag.SQUARE=this.parseTagSQUARE;this.parseTag.SQUAREFRAME=this.parseTagSQUAREFRAME;this.parseTag.CUBE=this.parseTagCUBE;this.parseTag.CUBEFRAME=this.parseTagCUBEFRAME;this.parseTag.CIRCLE=this.parseTagCIRCLE;this.parseTag.CIRCLEFRAME=this.parseTagCIRCLEFRAME;this.parseTag.POLYGON=this.parseTagPOLYGON;this.parseTag.POLYGONFRAME=this.parseTagPOLYGONFRAME;this.parseTag.SPHERE=this.parseTagSPHERE;this.parseTag.CYLINDER=this.parseTagCYLINDER;this.parseTag.PRISM=this.parseTagPRISM;this.parseTag.PRISMFRAME=this.parseTagPRISMFRAME;this.parseTag.CONE=this.parseTagCONE;this.parseTag.PYRAMID=this.parseTagPYRAMID;this.parseTag.PYRAMIDFRAME=this.parseTagPYRAMIDFRAME;this.parseTag.BUTTON=this.skipTag;this.parseTag.CANVAS=this.skipTagSilently;this.parseTag.DIV=this.skipTag;this.parseTag.SPAN=this.skipTag;}
parseTags()
{this.suica.debugCall('parseTags');this.suica.parser=null;this.parseTagsInElement(this.suica,this.suica.suicaTag);this.suica.render();}
parseTagsInElement(that,elem)
{for(var i=0;i<elem.children.length;i++)
{var tagName=elem.children[i].tagName;if(this.parseTag[tagName])
this.parseTag[tagName](this.suica,elem.children[i]);else
throw`error: unknown tag <${tagName}> in <${that.tagName}>`;this.parseTagsInElement(this.suica,elem.children[i]);}}
skipTag(suica,elem)
{suica.debugCall('skipTag',elem.tagName);}
skipTagSilently(suica,elem)
{}
parseTagOXYZ(suica,elem)
{suica.oxyz(elem.getAttribute('size')||Suica.DEFAULT.OXYZ.SIZE,elem.getAttribute('color')||Suica.DEFAULT.OXYZ.COLOR);}
parseTagDEMO(suica,elem)
{suica.demo(elem.getAttribute('distance')||Suica.DEFAULT.DEMO.DISTANCE,elem.getAttribute('altitude')||Suica.DEFAULT.DEMO.ALTITUDE);}
parseTagBACKGROUND(suica,elem)
{suica.background(elem.getAttribute('color')||Suica.DEFAULT.BACKGROUND.COLOR);}
parseTagONTIME(suica,elem)
{suica.onTime(elem.getAttribute('src')||Suica.DEFAULT.ONTIME.SRC);}
parseTagPOINT(suica,elem)
{var p=suica.point(elem.getAttribute('center')||Suica.DEFAULT.POINT.CENTER,elem.getAttribute('size')||Suica.DEFAULT.POINT.SIZE,elem.getAttribute('color')||Suica.DEFAULT.POINT.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagLINE(suica,elem)
{var p=suica.line(elem.getAttribute('center')||elem.getAttribute('from')||Suica.DEFAULT.LINE.CENTER,elem.getAttribute('to')||Suica.DEFAULT.LINE.TO,elem.getAttribute('color')||Suica.DEFAULT.LINE.COLOR);var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagSQUARE(suica,elem)
{var p=suica.square(elem.getAttribute('center')||Suica.DEFAULT.SQUARE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.SQUARE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.SQUARE.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagSQUAREFRAME(suica,elem)
{var p=suica.squareFrame(elem.getAttribute('center')||Suica.DEFAULT.SQUARE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.SQUARE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.SQUARE.COLORFRAME);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCUBE(suica,elem)
{var p=suica.cube(elem.getAttribute('center')||Suica.DEFAULT.CUBE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CUBE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CUBE.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCUBEFRAME(suica,elem)
{var p=suica.cubeFrame(elem.getAttribute('center')||Suica.DEFAULT.CUBE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CUBE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CUBE.COLORFRAME);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCIRCLE(suica,elem)
{var p=suica.circle(elem.getAttribute('center')||Suica.DEFAULT.CIRCLE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CIRCLE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CIRCLE.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCIRCLEFRAME(suica,elem)
{var p=suica.circleFrame(elem.getAttribute('center')||Suica.DEFAULT.CIRCLE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CIRCLE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CIRCLE.COLORFRAME);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPOLYGON(suica,elem)
{var p=suica.polygon(elem.getAttribute('count')||Suica.DEFAULT.POLYGON.COUNT,elem.getAttribute('center')||Suica.DEFAULT.POLYGON.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.POLYGON.SIZE),elem.getAttribute('color')||Suica.DEFAULT.POLYGON.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPOLYGONFRAME(suica,elem)
{var p=suica.polygonFrame(elem.getAttribute('count')||Suica.DEFAULT.POLYGON.COUNT,elem.getAttribute('center')||Suica.DEFAULT.POLYGON.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.POLYGON.SIZE),elem.getAttribute('color')||Suica.DEFAULT.POLYGON.COLORFRAME);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagSPHERE(suica,elem)
{var p=suica.sphere(elem.getAttribute('center')||Suica.DEFAULT.SPHERE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.SPHERE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.SPHERE.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCYLINDER(suica,elem)
{var p=suica.cylinder(elem.getAttribute('center')||Suica.DEFAULT.CYLINDER.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CYLINDER.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CYLINDER.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPRISM(suica,elem)
{var p=suica.prism(elem.getAttribute('count')||Suica.DEFAULT.PRISM.COUNT,elem.getAttribute('center')||Suica.DEFAULT.PRISM.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.PRISM.SIZE),elem.getAttribute('color')||Suica.DEFAULT.PRISM.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPRISMFRAME(suica,elem)
{var p=suica.prismFrame(elem.getAttribute('count')||Suica.DEFAULT.PRISM.COUNT,elem.getAttribute('center')||Suica.DEFAULT.PRISM.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.PRISM.SIZE),elem.getAttribute('color')||Suica.DEFAULT.PRISM.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagCONE(suica,elem)
{var p=suica.cone(elem.getAttribute('center')||Suica.DEFAULT.CONE.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.CONE.SIZE),elem.getAttribute('color')||Suica.DEFAULT.CONE.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPYRAMID(suica,elem)
{var p=suica.pyramid(elem.getAttribute('count')||Suica.DEFAULT.PYRAMID.COUNT,elem.getAttribute('center')||Suica.DEFAULT.PYRAMID.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.PYRAMID.SIZE),elem.getAttribute('color')||Suica.DEFAULT.PYRAMID.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}
parseTagPYRAMIDFRAME(suica,elem)
{var p=suica.pyramidFrame(elem.getAttribute('count')||Suica.DEFAULT.PYRAMID.COUNT,elem.getAttribute('center')||Suica.DEFAULT.PYRAMID.CENTER,Suica.parseSize(elem.getAttribute('size')||Suica.DEFAULT.PYRAMID.SIZE),elem.getAttribute('color')||Suica.DEFAULT.PYRAMID.COLOR);if(elem.hasAttribute('x'))p.x=Number(elem.getAttribute('x'));if(elem.hasAttribute('y'))p.y=Number(elem.getAttribute('y'));if(elem.hasAttribute('z'))p.z=Number(elem.getAttribute('z'));if(elem.hasAttribute('width'))p.width=Number(elem.getAttribute('width'));if(elem.hasAttribute('height'))p.height=Number(elem.getAttribute('height'));if(elem.hasAttribute('depth'))p.depth=Number(elem.getAttribute('depth'));var id=elem.getAttribute('id');if(id)window[id]=p;elem.suicaObject=p;}}
class Drawing
{static current;constructor(width=32,height=width,color=null)
{this.canvas=document.createElement('canvas');this.canvas.width=width;this.canvas.height=height;this.texture=null;this.context=this.canvas.getContext('2d');this.context.clearRect(0,0,width,height);if(color)
{this.context.fillStyle=color;this.context.fillRect(0,0,width,height);}
this.context.beginPath();}
moveTo(x=0,y=0)
{this.context.moveTo(x,this.canvas.height-y);}
lineTo(x=0,y=0)
{this.context.lineTo(x,this.canvas.height-y);}
curveTo(mx=0,my=0,x=0,y=0)
{this.context.quadraticCurveTo(mx,this.canvas.height-my,x,this.canvas.height-y);}
arc(x=0,y=0,r=10,from=0,to=360)
{this.context.arc(x,this.canvas.height-y,r,from*Math.PI/2,to*Math.PI/2);}
fillText(x=0,y=0,text='',color='black',font='20px Arial')
{this.context.fillStyle=color;this.context.font=font;this.context.fillText(text,x,this.canvas.height-y);}
stroke(color='black',width=1)
{this.texture=null;this.context.strokeStyle=color;this.context.lineWidth=width;this.context.stroke();this.context.beginPath();}
fill(color='gray')
{this.texture=null;this.context.fillStyle=color;this.context.fill();this.context.beginPath();}
fillAndStroke(fillColor='gray',strokeColor='black',width=1)
{this.texture=null;this.context.strokeStyle=strokeColor;this.context.lineWidth=width;this.context.stroke();this.context.fillStyle=fillColor;this.context.fill();this.context.beginPath();}
get image()
{if(!this.texture)
this.texture=new THREE.CanvasTexture(this.canvas);return this.texture;}
static precheck()
{if(!(Drawing.current instanceof Drawing))
throw'error: No Drawing instance is active';}}
window.drawing=function(width=32,height=width,color=null)
{Drawing.current=new Drawing(width,height,color);return Drawing.current;}
window.moveTo=function(x=0,y=0)
{Drawing.precheck();Drawing.current.moveTo(x,y);}
window.lineTo=function(x=0,y=0)
{Drawing.precheck();Drawing.current.lineTo(x,y);}
window.curveTo=function(mx=0,my=0,x=0,y=0)
{Drawing.precheck();Drawing.current.curveTo(mx,my,x,y);}
window.arc=function(x=0,y=0,r=10,from=0,to=360)
{Drawing.precheck();Drawing.current.arc(x,y,r,from,to);}
window.fillText=function(x=0,y=0,text='',color='black',font='20px Arial')
{Drawing.precheck();Drawing.current.fillText(x,y,text,color,font);}
window.stroke=function(color='black',width=1)
{Drawing.precheck();Drawing.current.stroke(color,width);}
window.fill=function(color='gray')
{Drawing.precheck();Drawing.current.fill(color);}
window.fillAndStroke=function(fillColor='gray',strokeColor='black',width=1)
{Drawing.precheck();Drawing.current.fillAndStroke(fillColor,strokeColor,width);}
window.image=function(url=null,repeatX=1,repeatY=1)
{Drawing.current=new THREE.TextureLoader().load(url);Drawing.current.wrapS=THREE.RepeatWrapping;Drawing.current.wrapT=THREE.RepeatWrapping;Drawing.current.magFilter=THREE.LinearFilter;Drawing.current.minFilter=THREE.LinearMipmapLinearFilter;Drawing.current.anisotropy=16;Drawing.current.repeat.set(repeatX,repeatY);return Drawing.current;}
﻿
class Mesh
{constructor(suica,threejsClass,geometry,material)
{this.suica=suica;this.threejs=new threejsClass(geometry,material);this.meshSize=[null,null,null];}
static createMaterials()
{var CANVAS_SIZE=64;var canvas=document.createElement('canvas');canvas.width=CANVAS_SIZE;canvas.height=CANVAS_SIZE;var context=canvas.getContext('2d');context.fillStyle='white';context.beginPath();context.arc(CANVAS_SIZE/2,CANVAS_SIZE/2,CANVAS_SIZE/2-1,0,2*Math.PI);context.fill();Mesh.pointMaterial=new THREE.PointsMaterial({color:'white',size:5,sizeAttenuation:true,map:new THREE.CanvasTexture(canvas),transparent:true,alphaTest:0.75,});Mesh.solidMaterial=new THREE.MeshStandardMaterial({color:'cornflowerblue',side:THREE.DoubleSide,});Mesh.flatMaterial=new THREE.MeshStandardMaterial({color:'cornflowerblue',side:THREE.DoubleSide,flatShading:true,});CANVAS_SIZE=4;canvas.width=CANVAS_SIZE;canvas.height=1;context.fillStyle='white';context.fillRect(0,0,canvas.width,canvas.height);Mesh.lineMaterial=new THREE.MeshBasicMaterial({color:'black',transparent:true,map:new THREE.CanvasTexture(canvas),});Mesh.lineMaterial.onBeforeCompile=shader=>{shader.fragmentShader=shader.fragmentShader.replace('#include <map_fragment>',`#ifdef USE_MAP

     vec4 texelColor = texture2D( map, vUv );

     diffuseColor *= texelColor;

    #endif`);}}
get center()
{this.suica.parser?.parseTags();return[this.threejs.position.x,this.threejs.position.y,this.threejs.position.z];}
set center(center)
{this.suica.parser?.parseTags();center=Suica.parseCenter(center);this.threejs.position.set(center[0],center[1],center[2]);}
get x()
{this.suica.parser?.parseTags();return this.threejs.position.x;}
set x(x)
{this.suica.parser?.parseTags();this.threejs.position.x=x;}
get y()
{this.suica.parser?.parseTags();return this.threejs.position.y;}
set y(y)
{this.suica.parser?.parseTags();this.threejs.position.y=y;}
get z()
{this.suica.parser?.parseTags();return this.threejs.position.z;}
set z(z)
{this.suica.parser?.parseTags();this.threejs.position.z=z;}
get color()
{this.suica.parser?.parseTags();var col=this.threejs.material.color;return[col.r,col.g,col.b];}
set color(col)
{this.suica.parser?.parseTags();this.threejs.material.color=Suica.parseColor(col);this.threejs.material.needsUpdate=true;}
set image(drawing)
{this.suica.parser?.parseTags();if(drawing instanceof Drawing)
{this.threejs.material.map=drawing.image;this.threejs.material.transparent=true,this.threejs.material.needsUpdate=true;return;}
if(drawing instanceof THREE.Texture)
{this.threejs.material.map=drawing;this.threejs.material.transparent=true,this.threejs.material.needsUpdate=true;return;}
throw'error: Parameter of `image` is not a drawing';}
updateScale()
{var width=this.meshSize[0];var height=this.meshSize[1];var depth=this.meshSize[2];if(height===null)height=width;if(depth===null)depth=width;switch(this.suica.orientation)
{case Suica.ORIENTATIONS.YXZ:this.threejs.scale.set(height,width,depth);break;case Suica.ORIENTATIONS.ZYX:this.threejs.scale.set(depth,height,width);break;case Suica.ORIENTATIONS.XZY:this.threejs.scale.set(width,depth,height);break;case Suica.ORIENTATIONS.ZXY:this.threejs.scale.set(height,depth,width);break;case Suica.ORIENTATIONS.XYZ:this.threejs.scale.set(width,height,depth);break;case Suica.ORIENTATIONS.YZX:this.threejs.scale.set(depth,width,height);break;default:throw'error: unknown orientation';}}
get width()
{return this.meshSize[0];}
set width(width)
{this.meshSize[0]=width;this.updateScale();}
get height()
{return(this.meshSize[1]!==null)?this.meshSize[1]:this.meshSize[0];}
set height(height)
{this.meshSize[1]=height;this.updateScale();}
get depth()
{return(this.meshSize[2]!==null)?this.meshSize[2]:this.meshSize[0];}
set depth(depth)
{this.meshSize[2]=depth;this.updateScale();}
get size()
{this.suica.parser?.parseTags();if(this.meshSize[2]===null)
{if(this.meshSize[1]===null)
return this.meshSize[0];else
return[this.meshSize[0],this.meshSize[1]];}
return[this.meshSize[0],this.meshSize[1],this.meshSize[2]];}
set size(size)
{this.suica.parser?.parseTags();if(Array.isArray(size))
{if(size.length==0)
this.meshSize=[null,null,null];else
if(size.length==1)
this.meshSize=[size[0],null,null];else
if(size.length==2)
this.meshSize=[size[0],size[1],null];else
this.meshSize=[size[0],size[1],size[2]];}
else
{this.meshSize=[size,null,null];}
this.updateScale();}}
Mesh.createMaterials();﻿
class Point extends Mesh
{static geometry=new THREE.BufferGeometry().setAttribute('position',new THREE.BufferAttribute(new Float32Array([0,0,0]),3));constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('point',center,size,color);super(suica,THREE.Points,Point.geometry,Mesh.pointMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}
get size()
{this.suica.parser?.parseTags();return this.threejs.material.size;}
set size(size)
{this.suica.parser?.parseTags();this.threejs.material.size=size;this.threejs.material.needsUpdate=true;}}
window.point=function(center=Suica.DEFAULT.POINT.CENTER,size=Suica.DEFAULT.POINT.SIZE,color=Suica.DEFAULT.POINT.COLOR)
{Suica.precheck();return Suica.current.point(center,size,color);}﻿
class Line extends Mesh
{constructor(suica,center,to,color)
{suica.parser?.parseTags();suica.debugCall('line',center,to,color);super(suica,THREE.LineSegments,Line.geometry.clone(),Mesh.lineMaterial.clone());this.center=center;this.color=color;this.to=to;suica.scene.add(this.threejs);}
get center()
{this.suica.parser?.parseTags();var pos=this.threejs.geometry.getAttribute('position');return[pos.getX(0),pos.getY(0),pos.getZ(0)];}
set center(center)
{this.suica.parser?.parseTags();center=Suica.parseCenter(center);this.threejs.geometry.getAttribute('position').setXYZ(0,center[0],center[1],center[2]);this.threejs.geometry.needsUpdate=true;}
get from()
{return this.center;}
set from(from)
{this.center=from;}
get to()
{this.suica.parser?.parseTags();var pos=this.threejs.geometry.getAttribute('position');return[pos.getX(1),pos.getY(1),pos.getZ(1)];}
set to(to)
{this.suica.parser?.parseTags();to=Suica.parseCenter(to);this.threejs.geometry.getAttribute('position').setXYZ(1,to[0],to[1],to[2]);this.threejs.geometry.needsUpdate=true;}
get size()
{throw'error: size is not available for line';}
set size(size)
{throw'error: size is not available for line';}
get width()
{throw'error: width is not available for line';}
set width(width)
{throw'error: width is not available for line';}
get height()
{throw'error: height is not available for line';}
set height(height)
{throw'error: height is not available for line';}
get depth()
{throw'error: depth is not available for line';}
set depth(depth)
{throw'error: depth is not available for line';}
get x()
{throw'error: x is not available for line';}
set x(x)
{throw'error: x is not available for line';}
get y()
{throw'error: y is not available for line';}
set y(y)
{throw'error: y is not available for line';}
get z()
{throw'error: z is not available for line';}
set z(z)
{throw'error: z is not available for line';}}
Line.geometry=new THREE.BufferGeometry();Line.geometry.setAttribute('position',new THREE.BufferAttribute(new Float32Array([0,0,0,0,30,0]),3));Line.geometry.setAttribute('uv',new THREE.BufferAttribute(new Float32Array([0,0,1,0]),2));window.line=function(center=Suica.DEFAULT.LINE.CENTER,to=Suica.DEFAULT.LINE.TO,color=Suica.DEFAULT.LINE.COLOR)
{Suica.precheck();return Suica.current.line(center,to,color);}﻿
class Square extends Mesh
{static geometry=new THREE.PlaneGeometry(1,1);constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('square',center,size,color);super(suica,THREE.Mesh,Square.geometry,Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}}
class SquareFrame extends Mesh
{constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('squareFrame',center,size,color);super(suica,THREE.LineSegments,SquareFrame.geometry,Mesh.lineMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}}
SquareFrame.geometry=new THREE.BufferGeometry();SquareFrame.geometry.setAttribute('position',new THREE.BufferAttribute(new Float32Array([-0.5,-0.5,0,+0.5,-0.5,0,+0.5,-0.5,0,+0.5,+0.5,0,+0.5,+0.5,0,-0.5,+0.5,0,-0.5,+0.5,0,-0.5,-0.5,0,]),3));SquareFrame.geometry.setAttribute('uv',new THREE.BufferAttribute(new Float32Array([0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,]),2));window.square=function(center=Suica.DEFAULT.SQUARE.CENTER,size=Suica.DEFAULT.SQUARE.SIZE,color=Suica.DEFAULT.SQUARE.COLOR)
{Suica.precheck();return Suica.current.square(center,size,color);}
window.squareFrame=function(center=Suica.DEFAULT.SQUARE.CENTER,size=Suica.DEFAULT.SQUARE.SIZE,color=Suica.DEFAULT.SQUARE.FRAMECOLOR)
{Suica.precheck();return Suica.current.squareFrame(center,size,color);}﻿
class Cube extends Mesh
{static geometry=new THREE.BoxGeometry(1,1,1);constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('cube',center,size,color);super(suica,THREE.Mesh,Cube.geometry,Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}}
class CubeFrame extends Mesh
{constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('cubeFrame',center,size,color);super(suica,THREE.LineSegments,CubeFrame.geometry,Mesh.lineMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}}
CubeFrame.geometry=new THREE.BufferGeometry();CubeFrame.geometry.setAttribute('position',new THREE.BufferAttribute(new Float32Array([-0.5,-0.5,-0.5,+0.5,-0.5,-0.5,+0.5,-0.5,-0.5,+0.5,+0.5,-0.5,+0.5,+0.5,-0.5,-0.5,+0.5,-0.5,-0.5,+0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,+0.5,+0.5,-0.5,+0.5,+0.5,-0.5,+0.5,+0.5,+0.5,+0.5,+0.5,+0.5,+0.5,-0.5,+0.5,+0.5,-0.5,+0.5,+0.5,-0.5,-0.5,+0.5,-0.5,-0.5,-0.5,-0.5,-0.5,+0.5,+0.5,-0.5,-0.5,+0.5,-0.5,+0.5,+0.5,+0.5,-0.5,+0.5,+0.5,+0.5,-0.5,+0.5,-0.5,-0.5,+0.5,+0.5,]),3));CubeFrame.geometry.setAttribute('uv',new THREE.BufferAttribute(new Float32Array([0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,]),2));window.cube=function(center=Suica.DEFAULT.CUBE.CENTER,size=Suica.DEFAULT.CUBE.SIZE,color=Suica.DEFAULT.CUBE.COLOR)
{Suica.precheck();return Suica.current.cube(center,size,color);}
window.cubeFrame=function(center=Suica.DEFAULT.CUBE.CENTER,size=Suica.DEFAULT.CUBE.SIZE,color=Suica.DEFAULT.CUBE.FRAMECOLOR)
{Suica.precheck();return Suica.current.cubeFrame(center,size,color);}﻿
class Polygon extends Mesh
{static geometry=[];constructor(suica,count,center,size,color)
{suica.parser?.parseTags();if(count<Suica.DEFAULT.CIRCLE.COUNT)
suica.debugCall('polygon',count,center,size,color);else
suica.debugCall('circle',center,size,color);if(!Polygon.geometry[count])
{Polygon.geometry[count]=new THREE.CircleGeometry(0.5,count,-Math.PI*(1/2-1/count));}
super(suica,THREE.Mesh,Polygon.geometry[count],Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;if(!Polygon.geometry[count])
{Polygon.geometry[count]=new THREE.CircleGeometry(0.5,count,-Math.PI*(1/2-1/count));}
this.threejs.geometry=Polygon.geometry[count];}}
class PolygonFrame extends Mesh
{static geometry=[];constructor(suica,count,center,size,color)
{suica.parser?.parseTags();if(count<Suica.DEFAULT.CIRCLE.COUNT)
suica.debugCall('polygonFrame',count,center,size,color);else
suica.debugCall('circleFrame',center,size,color);super(suica,THREE.Line,PolygonFrame.getGeometry(count),Mesh.lineMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
static getGeometry(count)
{if(!Polygon.geometry[count])
{PolygonFrame.geometry[count]=new THREE.BufferGeometry();let vertices=new Float32Array(3*count+3),uvs=new Float32Array(2*count+2);for(var i=0;i<=count;i++)
{var angle=2*Math.PI*i/count-Math.PI*(1/2-1/count);vertices[3*i]=0.5*Math.cos(angle);vertices[3*i+1]=0.5*Math.sin(angle);if(count>8)
uvs[2*i]=4*i/count;else
uvs[2*i]=i;}
PolygonFrame.geometry[count].setAttribute('position',new THREE.BufferAttribute(vertices,3));PolygonFrame.geometry[count].setAttribute('uv',new THREE.BufferAttribute(uvs,2));}
return PolygonFrame.geometry[count];}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;this.threejs.geometry=PolygonFrame.getGeometry(count);}}
window.circle=function(center=Suica.DEFAULT.CIRCLE.CENTER,size=Suica.DEFAULT.CIRCLE.SIZE,color=Suica.DEFAULT.CIRCLE.COLOR)
{Suica.precheck();return Suica.current.circle(center,size,color);}
window.circleFrame=function(center=Suica.DEFAULT.CIRCLE.CENTER,size=Suica.DEFAULT.CIRCLE.SIZE,color=Suica.DEFAULT.CIRCLE.FRAMECOLOR)
{Suica.precheck();return Suica.current.circleFrame(center,size,color);}
window.polygon=function(count=Suica.DEFAULT.POLYGON.COUNT,center=Suica.DEFAULT.POLYGON.CENTER,size=Suica.DEFAULT.POLYGON.SIZE,color=Suica.DEFAULT.POLYGON.COLOR)
{Suica.precheck();return Suica.current.polygon(count,center,size,color);}
window.polygonFrame=function(count=Suica.DEFAULT.POLYGON.COUNT,center=Suica.DEFAULT.POLYGON.CENTER,size=Suica.DEFAULT.POLYGON.SIZE,color=Suica.DEFAULT.POLYGON.FRAMECOLOR)
{Suica.precheck();return Suica.current.polygonFrame(count,center,size,color);}﻿
class Sphere extends Mesh
{static geometry;constructor(suica,center,size,color)
{suica.parser?.parseTags();suica.debugCall('sphere',center,size,color);if(!Sphere.geometry)
{Sphere.geometry=new THREE.SphereGeometry(0.5,Suica.DEFAULT.SPHERE.COUNT,Math.round(Suica.DEFAULT.SPHERE.COUNT/2));}
super(suica,THREE.Mesh,Sphere.geometry,Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;suica.scene.add(this.threejs);}}
window.sphere=function(center=Suica.DEFAULT.SPHERE.CENTER,size=Suica.DEFAULT.SPHERE.SIZE,color=Suica.DEFAULT.SPHERE.COLOR)
{Suica.precheck();return Suica.current.sphere(center,size,color);}
﻿
class Prism extends Mesh
{static geometry=[];constructor(suica,count,center,size,color,flatShading)
{suica.parser?.parseTags();if(count<Suica.DEFAULT.CYLINDER.COUNT)
suica.debugCall('prism',count,center,size,color);else
suica.debugCall('cylinder',center,size,color);if(!Prism.geometry[count])
{Prism.geometry[count]=new THREE.CylinderGeometry(0.5,0.5,1,count,1,false).translate(0,0.5,0);}
super(suica,THREE.Mesh,Prism.geometry[count],flatShading?Mesh.flatMaterial.clone():Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;if(!Prism.geometry[count])
{Prism.geometry[count]=new THREE.CylinderGeometry(0.5,0.5,1,count,1,false).translate(0,0.5,0);}
this.threejs.geometry=Prism.geometry[count];}}
class PrismFrame extends Mesh
{static geometry=[];constructor(suica,count,center,size,color)
{suica.parser?.parseTags();suica.debugCall('prismFrame',count,center,size,color);super(suica,THREE.LineSegments,PrismFrame.getGeometry(count),Mesh.lineMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
static getGeometry(count)
{if(!Prism.geometry[count])
{PrismFrame.geometry[count]=new THREE.BufferGeometry();let vertices=new Float32Array(3*2*3*count),uvs=new Float32Array(2*2*3*count);for(var i=0;i<count;i++)
{var angle1=2*Math.PI*i/count-Math.PI*(1/2-1/count),sin1=0.5*Math.sin(angle1),cos1=0.5*Math.cos(angle1);var angle2=2*Math.PI*(i+1)/count-Math.PI*(1/2-1/count),sin2=0.5*Math.sin(angle2),cos2=0.5*Math.cos(angle2);vertices[18*i]=cos1;vertices[18*i+1]=0;vertices[18*i+2]=sin1;vertices[18*i+3]=cos2;vertices[18*i+4]=0;vertices[18*i+5]=sin2;vertices[18*i+6]=cos1;vertices[18*i+7]=1;vertices[18*i+8]=sin1;vertices[18*i+9]=cos2;vertices[18*i+10]=1;vertices[18*i+11]=sin2;vertices[18*i+12]=cos1;vertices[18*i+13]=0;vertices[18*i+14]=sin1;vertices[18*i+15]=cos1;vertices[18*i+16]=1;vertices[18*i+17]=sin1;console.assert(uvs[2*i+1]==0);var u1,u2;if(count>8)
{u1=4*i/count;u2=4*(i+1)/count;}
else
{u1=i;u2=i+1;}
uvs[12*i]=u1;uvs[12*i+2]=u2;uvs[12*i+4]=u1;uvs[12*i+6]=u2;uvs[12*i+8]=0;uvs[12*i+10]=1;}
PrismFrame.geometry[count].setAttribute('position',new THREE.BufferAttribute(vertices,3));PrismFrame.geometry[count].setAttribute('uv',new THREE.BufferAttribute(uvs,2));}
return PrismFrame.geometry[count];}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;this.threejs.geometry=PrismFrame.getGeometry(count);}}
window.cylinder=function(center=Suica.DEFAULT.CYLINDER.CENTER,size=Suica.DEFAULT.CYLINDER.SIZE,color=Suica.DEFAULT.CYLINDER.COLOR)
{Suica.precheck();return Suica.current.cylnder(center,size,color);}
window.prism=function(count=Suica.DEFAULT.PRISM.COUNT,center=Suica.DEFAULT.PRISM.CENTER,size=Suica.DEFAULT.PRISM.SIZE,color=Suica.DEFAULT.PRISM.COLOR)
{Suica.precheck();return Suica.current.prism(count,center,size,color);}
window.prismFrame=function(count=Suica.DEFAULT.PRISM.COUNT,center=Suica.DEFAULT.PRISM.CENTER,size=Suica.DEFAULT.PRISM.SIZE,color=Suica.DEFAULT.PRISM.FRAMECOLOR)
{Suica.precheck();return Suica.current.prismFrame(count,center,size,color);}﻿
class Pyramid extends Mesh
{static geometry=[];constructor(suica,count,center,size,color,flatShading)
{suica.parser?.parseTags();if(count<Suica.DEFAULT.CONE.COUNT)
suica.debugCall('pyramid',count,center,size,color);else
suica.debugCall('cone',center,size,color);if(!Prism.geometry[count])
{Prism.geometry[count]=new THREE.ConeGeometry(0.5,1,count,1,false).translate(0,0.5,0);}
super(suica,THREE.Mesh,Prism.geometry[count],flatShading?Mesh.flatMaterial.clone():Mesh.solidMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;if(!Pyramid.geometry[count])
{Pyramid.geometry[count]=new THREE.ConeGeometry(0.5,1,count,1,false).translate(0,0.5,0);}
this.threejs.geometry=Pyramid.geometry[count];}}
class PyramidFrame extends Mesh
{static geometry=[];constructor(suica,count,center,size,color)
{suica.parser?.parseTags();suica.debugCall('pyramidFrame',count,center,size,color);super(suica,THREE.LineSegments,PyramidFrame.getGeometry(count),Mesh.lineMaterial.clone());this.center=center;this.color=color;this.size=size;this.n=count;suica.scene.add(this.threejs);}
get count()
{this.suica.parser?.parseTags();return this.n;}
static getGeometry(count)
{if(!Pyramid.geometry[count])
{PyramidFrame.geometry[count]=new THREE.BufferGeometry();let vertices=new Float32Array(3*2*2*count),uvs=new Float32Array(2*2*2*count);for(var i=0;i<count;i++)
{var angle1=2*Math.PI*i/count-Math.PI*(1/2-1/count),sin1=0.5*Math.sin(angle1),cos1=0.5*Math.cos(angle1);var angle2=2*Math.PI*(i+1)/count-Math.PI*(1/2-1/count),sin2=0.5*Math.sin(angle2),cos2=0.5*Math.cos(angle2);vertices[12*i]=cos1;vertices[12*i+1]=0;vertices[12*i+2]=sin1;vertices[12*i+3]=cos2;vertices[12*i+4]=0;vertices[12*i+5]=sin2;vertices[12*i+6]=cos1;vertices[12*i+7]=0;vertices[12*i+8]=sin1;vertices[12*i+9]=0;vertices[12*i+10]=1;vertices[12*i+11]=0;console.assert(uvs[2*i+1]==0);var u1,u2;if(count>8)
{u1=4*i/count;u2=4*(i+1)/count;}
else
{u1=i;u2=i+1;}
uvs[8*i]=u1;uvs[8*i+2]=u2;uvs[8*i+4]=0;uvs[8*i+6]=1;}
PyramidFrame.geometry[count].setAttribute('position',new THREE.BufferAttribute(vertices,3));PyramidFrame.geometry[count].setAttribute('uv',new THREE.BufferAttribute(uvs,2));}
return PyramidFrame.geometry[count];}
set count(count)
{this.suica.parser?.parseTags();if(count==this.n)return;this.threejs.geometry=PyramidFrame.getGeometry(count);}}
window.cone=function(center=Suica.DEFAULT.CONE.CENTER,size=Suica.DEFAULT.CONE.SIZE,color=Suica.DEFAULT.CONE.COLOR)
{Suica.precheck();return Suica.current.cone(center,size,color);}
window.pyramid=function(count=Suica.DEFAULT.PYRAMID.COUNT,center=Suica.DEFAULT.PYRAMID.CENTER,size=Suica.DEFAULT.PYRAMID.SIZE,color=Suica.DEFAULT.PYRAMID.COLOR)
{Suica.precheck();return Suica.current.pyramid(count,center,size,color);}
window.pyramidFrame=function(count=Suica.DEFAULT.PYRAMID.COUNT,center=Suica.DEFAULT.PYRAMID.CENTER,size=Suica.DEFAULT.PYRAMID.SIZE,color=Suica.DEFAULT.PYRAMID.FRAMECOLOR)
{Suica.precheck();return Suica.current.pyramidFrame(count,center,size,color);}}